function extend(ns,ns_string){for(var parts=ns_string.split("."),parent=ns,pl=(parts="myApp"==parts[0]?parts.slice(1):parts).length,i=0;i<pl;i++)void 0===parent[parts[i]]&&(parent[parts[i]]={}),parent=parent[parts[i]];return parent}extend(window,"qr.utils"),window.qr.utils={xml2json:function(xml){var obj={};if(1==xml.nodeType){if(0<xml.attributes.length){obj["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else 3==xml.nodeType&&(obj=xml.nodeValue);if(xml.hasChildNodes())for(var i=0;i<xml.childNodes.length;i++){var old,item=xml.childNodes.item(i),nodeName=item.nodeName;void 0===obj[nodeName]?obj[nodeName]=xmlToJson(item):(void 0===obj[nodeName].push&&(old=obj[nodeName],obj[nodeName]=[],obj[nodeName].push(old)),obj[nodeName].push(xmlToJson(item)))}return obj},disableDebugging:function(){var console={log:function(){},time:function(){},timeEnd:function(){}};window.console=console},getParameterByName:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");name=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(location.search);return null==name?"":decodeURIComponent(name[1].replace(/\+/g," "))},getLang:function(){return window.LANG},isIE:function(){var myNav=navigator.userAgent.toLowerCase();return-1!=myNav.indexOf("msie")&&parseInt(myNav.split("msie")[1])},isChrome:function(){return-1<navigator.userAgent.toLowerCase().indexOf("chrome")},isBreakpoint:function(alias){return $(".device-"+alias).is(":visible")},scrollTo:function($target,callback,offsetX){offsetX=offsetX||-30,_.isUndefined($target.first())||($target=$target.first().offset(),_.isUndefined($target)?$("html, body").animate({scrollTop:offsetX+"px"},{duration:500,queue:!1,complete:callback}):$("html, body").animate({scrollTop:$target.top+offsetX+"px"},{duration:500,queue:!1,complete:callback}))},makeTogglable:function(selector){$(selector).toggleContent()},localStorageAvailable:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},makeHash:function(string){var hash=0;if(0!=string.length)for(i=0;i<string.length;i++)hash=(hash<<5)-hash+(char=string.charCodeAt(i)),hash&=hash;return hash},addInputTooltip:function(selector,text){var container="",text=($(selector).hasAttr("data-tooltip-container")&&(container=selector=$(selector).attr("data-tooltip-container")),$(selector).attr("title"));$(selector).popover("destroy").popover({trigger:"manual",container:container,template:'<div class="popover popover-error" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',content:text}).popover("show")},formValidationTooltip:function(selector,text,hasError,scrollToFirstError){var container,dotTemp,popoverID,closeIcon;function _setTooltip(){$(selector).popover("destroy").popover({trigger:"manual",container:container,template:'<div class="popover popover-error" role="tooltip"><div class="arrow"></div>'+closeIcon+'<h3 class="popover-title"></h3><div class="popover-content"></div></div>',content:text}).popover("show"),$(document).on("click",".close-tooltip",function(){$(this).closest(".popover").popover("destroy")})}$(selector)&&(container="",$(selector).hasAttr("data-error-container")&&(selector=$(selector).attr("data-error-container"),container=selector),hasError&&""!==text?(dotTemp=hasError="",$(selector).hasAttr("data-error-stayInPlace"),"tooltip"==$(selector).attr("rel")&&(hasError=$(selector).attr("title"),dotTemp=$(selector).attr("data-original-title"),$(selector).attr("title",""),$(selector).attr("data-original-title","")),$(selector).hasAttr("aria-describedby")?(popoverID="#"+$(selector).attr("aria-describedby"),$(popoverID+" .popover-content").text(text),1==scrollToFirstError&&$(".popover.in").length?_.delay(function(){window.qr.utils.scrollTo($(".popover.in:eq(0)"),!1,-100)}):window.qr.utils.scrollTo($(popoverID))):(closeIcon="",$(selector).hasAttr("error-show-close-icon")&&(closeIcon='<span class="pull-right" style="top: 1px; left: -1px; position: relative;"><i class="close-tooltip icon icon-close"></i></span>'),1==scrollToFirstError?$(".popover.in").length?(_setTooltip(),_.delay(function(){window.qr.utils.scrollTo($(".popover.in:eq(0)"),!1,-100)})):window.qr.utils.scrollTo($(selector),_setTooltip(),-100):window.qr.utils.scrollTo($(selector),_setTooltip())),$(selector).hasAttr("data-error-top-offset")&&$("#"+$(selector).attr("aria-describedby")).css({marginTop:$(selector).attr("data-error-top-offset")}),$(selector).hasAttr("data-error-left-offset")&&$("#"+$(selector).attr("aria-describedby")).css({marginLeft:$(selector).attr("data-error-left-offset")}),"tooltip"==$(selector).attr("rel")&&($(selector).attr("title",hasError),$(selector).attr("data-original-title",dotTemp),1==scrollToFirstError&&$(".popover.in").length?_.delay(function(){window.qr.utils.scrollTo($(".popover.in:eq(0)"),!1,-100)}):window.qr.utils.scrollTo($(selector)))):$(selector).popover("destroy"))},removeFormValidationTooltip:function(selector){void 0!==$(selector).popover&&$(selector).removeClass("in",function(){setTimeout(function(){$(selector).popover("destroy")},450)})},restrictionMessage:function(html){void 0!==$(".modal")&&$(".modal").modal("hide");var notnow=window.qr.texts.general.UPGRADE_NO_THANKS,upgrade=window.qr.texts.general.UPGRADE_YES,id=(title=$(html).attr("title"),Math.floor(1e4*Math.random(0,1e4))),upgradeAccountUrl="/upgrade/?fromLimit="+encodeURIComponent(title),dialog="",dialog=(dialog=(dialog=(dialog=(dialog=(dialog=(dialog=(dialog+='<div class="modal modal-compact fade" id="modal-id-compact-'+id+'">')+'<div class="modal-dialog">'+'<div class="modal-content">')+'<div class="modal-header">'+'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>')+('<h2 class="modal-title">'+title+"</h2>")+"</div>")+('<div class="modal-body"><p>'+html+"</p></div>")+'<div class="modal-footer">')+('<a type="button" href="'+upgradeAccountUrl+'" class="btn btn-primary primary">'+upgrade+"</a>")+('<button type="button" class="btn btn-default" data-dismiss="modal">'+notnow+"</button>"))+"</div>"+" </div>")+"</div>"+"</div>";$("body").append(dialog),$("#modal-id-compact-"+id).modal({keyboard:!0})},checkJSON:function(string,redirect){var loginUrl="/site/logout/?relogin=true",redirect=void 0!==redirect?redirect:!1;return"string"!=typeof string?redirect&&(window.location=loginUrl):string.length?"{"!=string.substr(0,1)&&redirect&&(window.location=loginUrl):redirect&&(window.location=loginUrl),!1},submitForm:function(form,successCallback,errorCallback){var url=form.attr("action"),type=form.attr("method"),form=(form=form.serialize())+"&code_type_id="+$("[id$=qrcode_type_id]").val();1==window.qr.utils.states.get("saveAsDraft")&&(form+="&saveAsDraft=true"),"function"!=typeof successCallback&&(successCallback=function(response){}),"function"!=typeof errorCallback&&(errorCallback=function(response){}),$.ajax({url:url+"#123",type:type,data:form,success:successCallback,error:errorCallback,cache:!1})}},extend(window,"qr.utils"),window.qr.utils.template=function(template){template=Hogan.template(template);return{render:function(data){return template.render(data)}}},extend(window,"qr.utils"),window.qr.utils.cookie={_defaults:{path:"/",expires:360},set:function(name,value,defaults){defaults=defaults||this._defaults,$.cookie(name,value,defaults)},get:function(name){return $.cookie(name)}},window.qr.utils.checkContrast=function(foreground,background,ratio){background=_hex2rgb(background),foreground=_hex2rgb(foreground);return!((_luminanace(background[0],background[1],background[2])+.05)/(_luminanace(foreground[0],foreground[1],foreground[2])+.05)<ratio);function _hex2rgb(colour){var r=(colour="#"==colour.charAt(0)?colour.substr(1):colour).charAt(0)+""+colour.charAt(1),g=colour.charAt(2)+""+colour.charAt(3),colour=colour.charAt(4)+""+colour.charAt(5);return[parseInt(r,16),parseInt(g,16),parseInt(colour,16)]}function _luminanace(r,g,b){r=[r,g,b].map(function(v){return(v/=255)<=.03928?v/12.92:Math.pow((v+.055)/1.055,2.4)});return.2126*r[0]+.7152*r[1]+.0722*r[2]}},window.qr.utils.events={blockedEvents:{},registerOnceEvents:{},registerOnce:function(eventName,callback,place){1!=this.registerOnceEvents[eventName+place]&&($("body").on(eventName,callback),this.registerOnceEvents[eventName+place]=!0)},register:function(eventName,callback){$("body").on(eventName,callback)},block:function(eventName){this.blockedEvents[eventName]=!0},unblock:function(eventName){this.blockedEvents[eventName]=!1},unregister:function(eventName,callback){$("body").off(eventName,callback)},trigger:function(eventName,param){1!=this.blockedEvents[eventName]&&$("body").trigger(eventName,param)}},window.qr.utils.states={_values:[],set:function(name,value){this._values[name]=value,window.qr.utils.events.trigger("stateChanged",name)},get:function(name){return this._values[name]}},extend(window.qr,"utils.fileupload"),window.qr.utils.fileupload=function(_options){var old_file="",duration=0,options=$.extend({dropZoneSelector:".uploadButtonContainer",fileInfoSelector:".uploadedFileInfo",hideOnUploadSelector:".hideOnUpload",progressBarSelector:"#progress",errorSelector:"#errorContainer",uploadFileInformation:"#fileInfo"},_options),_options={dataType:"json",url:options.fileUploadUrl,dropZone:$(options.dropZoneSelector),start:function(e,data){$(options.dropZoneSelector).removeClass("fileover filedrag"),$(options.errorSelector).hide(),$(options.dropZoneSelector).addClass("progressBorder"),$(options.hideOnUploadSelector).hide(),_setProgress(0),_hideFileInfo(),options.onStart&&"function"==typeof options.onStart&&options.onStart()},progressall:function(e,data){0==duration&&(duration=Math.round((new Date).getTime()/1e3)),void 0!==data.result&&void 0!==data.result.storageError||_hideFileInfo();data=parseInt(data.loaded/data.total*100,10);_setProgress(data),90<data&&(function _fakeProcess(call,seconds){value=10*call;call<10&&window.setTimeout(function(){_fakeProcess(call+1,seconds)},100*(seconds+2))}(1,seconds=Math.round((new Date).getTime()/1e3)-duration),duration=0)},done:function(e,data){setTimeout(function(){_setProgress(0),$(options.dropZoneSelector).removeClass("progressBorder"),$(options.hideOnUploadSelector).show(),$(options.dropZoneSelector).removeClass("hover"),$(options.errorSelector).html(""),options.onDone&&"function"==typeof options.onDone&&options.onDone(),"error"==data.result.status?($(options.inputUrlId).val(""),$(options.hideOnUploadSelector).show(),_hideFileInfo()):_showFileInfo(),$(document).trigger("changedata"),options.onFileUploaded&&"function"==typeof options.onFileUploaded&&options.onFileUploaded(this,data.result),_initButtons()},1e3)}};function _initButtons(){options.editButtonSelector&&$("body").on("click",options.editButtonSelector,function(){old_file=$(this).attr("title"),options.inputId&&$(options.inputId).click()}),options.deleteButtonSelector&&options.deleteFileUrl&&$(options.deleteButtonSelector).on("click",function(){old_file=$(this).attr("fileid");var _this=this;$.ajax({url:options.deleteFileUrl,data:{codetype:options.codeType,filename:old_file}}).done(function(){_hideFileInfo(),$(options.inputUrlId).val(""),$(options.inputFilenameId).val(""),_.isFunction(options.onDelete)&&options.onDelete(_this)})})}function _setProgress(percentage){$(options.progressBarSelector+" .progress-bar").css("width",percentage+"%")}function _hideFileInfo(){$(options.fileInfoSelector).hide(),$(options.uploadFileInformation).css("display","none")}function _showFileInfo(){$(options.fileInfoSelector).show(),$(options.uploadFileInformation).css("display","block")}options.uploadButtonSelector,$(options.dropZoneSelector).on("dragenter dragover",function(){$(options.dropZoneSelector).addClass("fileover filedrag")}).on("dragleave mouseup",function(e){e.stopPropagation(),$(options.dropZoneSelector).removeClass("fileover filedrag ")}),$(window).on("dragenter dragover",function(){$(options.dropZoneSelector).addClass("filedrag")}).on("dragleave mouseup",function(){$(options.dropZoneSelector).removeClass("filedrag")}),this.setup=function(filename,s3){$(options.deleteButtonSelector).attr("title",filename),$(options.inputUrlId).val(s3).change(),$(options.inputFilenameId).val(filename),$("#fileName").html(filename),(""!=filename?_showFileInfo:_hideFileInfo)()},_initButtons(),$(options.uploadButtonSelector).fileupload(_options).bind("fileuploadchange","body",function(e,data){old_file=$(options.editButtonSelector).attr("title")})},extend(window.qr,"utils.trackUser"),window.qr.utils.trackUser={event:function(eventName,options){Intercom("trackEvent",eventName,options),window.setTimeout(function(){Intercom("boot",window.intercomSettings),Intercom("update")},4e3)}},extend(window.qr,"utils.redirectAlert"),window.qr.utils.redirectAlert={_callback:function(e){var message="Are you sure you want to leave this Page.",e=e||window.event;return window.redirectMessage&&(message=window.redirectMessage),e&&(e.returnValue=message),message},enable:function(message){message&&(window.redirectMessage=message),window.addEventListener&&window.addEventListener("beforeunload",this._callback)},disable:function(){window.removeEventListener&&window.removeEventListener("beforeunload",this._callback)}},extend(window.qr,"utils.loader"),window.qr.utils.loader={show:function(selector){var selector=$(selector),$overlay=$("<div class='spinner-overlay'></div>"),spinner=(selector.append($overlay),new Spinner(window.qr.CONSTANTS.SPINNER_OPTIONS));selector.data("spinner",spinner),spinner.spin($overlay[0]),$overlay.addClass("loading")},hide:function(selector){var selector=$(selector),$overlay=selector.find(".spinner-overlay");0!=$overlay.length&&0!=selector.length&&($overlay.removeClass("loading"),$(".spinner",selector).size()&&"undefined"!==selector.data("spinner")&&(selector.data("spinner").stop(),selector.data("spinner",!1)),_.delay(function(){$overlay.remove()},800))}},extend(window.qr,"utils.ui.Spinbutton"),window.qr.utils.ui.Spinbutton=function(options){var ladda,options=$(options.selector);if(0!==options.length)return ladda=Ladda.create(options[0]),options.addClass("ladda-button").attr("data-style","expand-left"),{startLoad:function(){ladda.start()},stopLoad:function(){ladda.stop()}}},extend(window.qr,"utils.ui.Input"),window.qr.utils.ui.Input=function(options){var $input=$(options.selector),initialValue=(initialValue=$input.val())||"";return $input.on("keyup",function(){var value=$(this).val();value==initialValue?window.qr.utils.events.trigger(options.resetEventName):window.qr.utils.events.trigger(options.changeEventName),_.isFunction(options.onChange)&&options.onChange(value)}),{setInitialValue:function(value){initialValue=value}}},extend(window.qr,"utils.ui.switchlist"),window.qr.utils.ui.switchlist=function(selector,options){var _this=this,animationDuration=(this.options={onRemove:function(){},onAdd:function(){},onChange:function(item){}},$.extend(this.options,options),$.each($(selector),function(index,value){var $this=$(this);!function(){var value=$("input",$this[0]).attr("value");$("a[data-value|='"+value+"']",$this).addClass("active")}()}),800);Modernizr.csstransitions||(animationDuration=0),$(selector).on("mouseenter",".btn-item",function(e){var $this=$(this);_.delay(function(){$this.addClass("ready")},animationDuration)}).on("mouseenter",".btn-item",function(e){$(this).removeClass("ready")}),$(selector).on("click",".btn-item",function(e){e.preventDefault(),e.stopPropagation();var e=$(this),$input=$(this).siblings("input");$(selector).find(".active").removeClass("active"),e.addClass("active"),$input.attr("value",e.attr("data-value")).change(),_.isFunction(_this.options.onChange)&&_this.options.onChange(this)}),this.unselectAll=function(){$(selector).find(".active").removeClass("active")},this.selectItem=function(id){$(selector).find("a[id$=_"+id+"]").addClass("active")},this.selectItemByIndex=function(index){$(".btn-item",selector).index(index).addClass("active")},this.addItem=function(content,select){content='<a class="btn btn-default btn-item"><img src="'+content+'"></button>';$(".btn-item",selector).last().after(content),$(".btn-item",selector).last().click()},this.removeItem=function(index){$(".btn-item",selector).index(index).remove()}},extend(window.qr,"utils.code.type"),window.qr.utils.code.type=function(options){var _this=this;this.data={process:!1,data:!1,YII_CSRF_TOKEN:GLOBAL_CSRF_TOKEN},this.options={codeType:!1,init:function(){},onSetData:function(value){_this.setQRCodeData()}},this.hasAjaxValidation=function(turnOn){if(void 0===turnOn)return this._hasAjaxValidation;this._hasAjaxValidation=turnOn},this.isDynamicCode=function(){switch($("[id$=_trackable]").val()){case"1":var shortURL;this.lastCodeWasDynamic=!0,this._blockQRCodeImageRefresh=!1,$(".hide-on-static").show(),$(".show-on-static").hide(),$(".disable-on-static").removeClass("inactive"),0==$(".shorturlCustomizer #shorturlCustomizerCode").size()?""!=$("#shortcodeHolder").val()&&$("#shortcodeHolder").val():(shortURL=$("#shorturlCustomizerUrl").val(),window.qr.utils.events.trigger("updateQRCodeData",{value:shortURL,force:!0}),$("#shorturlHolder").val(shortURL),this._blockQRCodeImageRefresh=!0),window.qr.utils.events.trigger("generatorFormChanged");break;case"0":this.lastCodeWasDynamic=!1,this._blockQRCodeImageRefresh=!1,$(".hide-on-static").hide(),$(".show-on-static").show(),$(".disable-on-static").addClass("inactive"),window.qr.utils.events.registerOnce("generatorFormChanged",function(){var text=$("#formHere form").serialize(),options={};options.value=text,options.process=$("#formHere form").attr("static-type"),window.qr.utils.events.trigger("updateQRCodeData",options)},"onIsDynamicCode"),window.qr.utils.events.unblock("updateQRCodeData"),window.qr.utils.events.trigger("generatorFormChanged")}setTimeout(function(){$(".editMode").removeClass("switchMode"),$(".addMode").removeClass("switchMode")},0)},this.init=function(){return window.qr.utils.events.register("afterFormLoad",this.isDynamicCode),window.qr.utils.events.register("updateQRCodeData",this.updateDataViaTrigger),this.options.init(),this},this.setQRCodeData=function(){$.post("/create/setqrcodedata",_this.data,function(result){"success"==result.status&&("value"in result&&result.value&&$("#formHere").attr("data-code-content",result.value),window.qr.utils.events.trigger("updateQRCode"))},"json")},this.handleResponse=function(result){if(window.qr.utils.checkJSON(result.response,!0),"success"==(result=$.parseJSON(result.response)).status){if("add"===window.qr.utils.states.get("scenario")&&window.qr.generator.goTo("designer"),$("#oldCodeId").attr("value",result.newOldCodeId),window.qr.utils.states.set("saveAsDraft",!1),"content"in result&&result.content&&$("#formHere").attr("data-code-content",result.content),window.qr.utils.events.trigger("updateQRCode"),window.qr.utils.states.get("dontRedirectAfterSubmitting"))return window.qr.utils.states.set("dontRedirectAfterSubmitting"),!1;2==window.qr.generator.currentIndex||window.qr.utils.states.get("saveCodeDirectly")?window.location.assign("/manage/?aftercreate=1&count="+result.codeCount):window.qr.utils.states.get("saveCodeAfterEditing")&&window.qr.utils.events.trigger("generatorFormSaved")}else window.qr.utils.events.trigger("generatorFormError"),result.accountRelated?(html=$(result.message).html())?(result.limitedNumber&&0!=result.limitedNumber&&(html=html.replace("__LIMITEDNUMBER__",result.limitedNumber)),window.qr.utils.restrictionMessage(html),window.qr.generator.spinbuttonSave&&_.delay(function(){window.qr.generator.spinbuttonSave.stopLoad()},100)):alert(result.message,LABELS.accountDialogTitle):alert(result.message,LABELS.validationDialogTitle)},this.submitForm=function(form,successCallback,errorCallback){window.qr.utils.submitForm(form,successCallback,errorCallback)},this.updateDataViaTrigger=function(eventName,options){if(1==this._blockQRCodeImageRefresh&&!options.force)return!1;_.isString(options)&&(options={value:options,process:!1}),JSON.stringify(options)==JSON.stringify(this._currentQRCodeValue)&&1!=options.force||(this._currentQRCodeValue=options,_this.setData(options.value,options.process))},this.setData=function(value,process){return _this.data.process=process||!1,_this.data.data=value,_this.options.onSetData(value),this},this.getData=function(){return _this.data.data},this.setOptions=function(options){$.extend(_this.options,options)},this.setOptions(options)};var dynamicCode={codeType:"url"},staticCode={codeType:"url"},AngularHelper=(extend(window.qr,"utils.code.factory"),window.qr.utils.code.factory={_instance:!1,_isStatic:!1,_codeType:!1,init:function(){},setModel:function(codeType){return this._instance=!1,this._codeType=codeType,this},getModel:function(){if(!this._instance){switch(this._codeType){case"dynamicCode":this._instance=new window.qr.utils.code.type(dynamicCode);break;case"staticCode":this._instance=new window.qr.utils.code.type(staticCode);break;default:this._instance=new window.qr.utils.code.type(dynamicCode)}this._instance.init()}return this._instance}},extend(window.qr,"utils.optimizely"),window.qr.utils.optimizely={isAbTestVariantActive:function(experimentId,variantId){if("undefined"==typeof optimizely||!optimizely.initialized)return!1;var optimizelyState=optimizely.get("state");return optimizelyState.getActiveExperimentIds().includes(experimentId)&&optimizelyState.getVariationMap()[experimentId].id==variantId},trackOptimizelyEvent:function(eventName,tags={}){window.optimizely=window.optimizely||[],window.optimizely.push({type:"event",eventName:eventName,tags:tags})}},extend(window,"qr.CONSTANTS"),window.qr.CONSTANTS.SPINNER_OPTIONS={lines:13,length:0,width:4,radius:20,corners:1,rotate:0,direction:1,color:"#000",speed:.9,trail:100,zIndex:2e9,top:0,left:0},extend(window.qr,"global"),window.qr.global={init:function(){function _refreshTooltips(){$("[rel=tooltip]").tooltip({delay:{show:100,hide:100},container:"body"}),0<$(".btn-help").length&&$(".btn-help").tooltip({delay:{show:100,hide:100},container:"body",title:window.qr.texts.general.TOUR})}$(document).on("click","#logo",function(){window.location.assign("/manage/?logoclick")}),window.qr.utils.events.register("refreshUi",function(){_refreshTooltips(),$("#formHere input").unbind("keydown").on("keydown",function(e){if(13==e.keyCode)return $(e.target).blur().blur(),e.preventDefault(),e.stopPropagation(),!1})}),$(function(){var keyStop={13:"input:text",end:null};$(document).bind("keydown",function(event){var selector=keyStop[event.which];return void 0!==selector&&$(event.target).is(selector)&&event.preventDefault(),!0})}),$(document).on("click",".page-alert .close",function(e){e.preventDefault(),$(this).closest(".page-alert").removeClass("in")}),$(".panel-heading a").addClass("collapsed"),_refreshTooltips(),this.initFormTooltips(),this.initStickyHeader()},initFormTooltips:function(){$(document).on("focus","[rel=form-tooltip]",function(){var container="";$(this).hasAttr("data-tooltip-container")&&(container=selector=$(selector).attr("data-tooltip-container")),$(this).attr("title");$(this).popover({trigger:"manual",container:container,template:'<div class="popover popover-error fade" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>'}).popover("show")}).on("focusout","[rel=form-tooltip]",function(){$(this).popover()&&$(this).popover("hide")})},trackUserEvent:function(id,callback){id=parseInt(id),$.post("/account/logactivity?actionId="+id,{},function(data){callback&&callback(data)},"json")},initStickyHeader:function(){$(document).on("click","#badge-plan, #badgePopover ,#user",function(e){e.stopPropagation(),e.stopImmediatePropagation()}),$(document).click(function(e){$("#badgePopover").removeClass("in")}),setTimeout(function(){$("#badge-plan").popover(),$("#user").tooltip({delay:{show:200,hide:800}}),$(document).scroll(function(){var top=$(this).scrollTop();$("body").hasClass("noscrollnavigation")||(60<top&&!$("body").hasClass("uncompact")?$("body").addClass("compact"):$("body").removeClass("compact"))})},1e3)}},$(document).ready(function(){window.qr.global.init()}),function(){function AngularHelper(){}return AngularHelper.Compile=function($targetDom,htmlToCompile,applicationName){angular.injector(["ng",applicationName||"app"]).invoke(["$compile","$rootScope",function($compile,$rootScope){var $scope=$targetDom.html(htmlToCompile).scope();$compile($targetDom)($scope||$rootScope),($scope||$rootScope).$digest()}])},AngularHelper}()),recycleUrl=(extend(window,"qr.tour"),window.qr.tour={_intro:!1,options:!1,name:!1,init:function(steps,name,onCompleteOrExit,onBeforeStart){var _this=this;this.name=name,this._intro=introJs(),this.options=window.TOURSETTINGS,$(document).on("click",".btn-help",function(e){return e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),_this.stop(),onBeforeStart&&onBeforeStart.call(),setTimeout(function(){_this.start(_this._getSteps(steps),!1,onCompleteOrExit)},200),!1})},_allowTour:function(name){return"true"==window.qr.utils.getParameterByName("tour")||!(!name||$.cookie(name))},_startTour:function(introjs,onCompleteOrExit,softScroll){var _this=this;this._hideButtonTooltip(),setTimeout(function(){$(".introjs-overlay").css("opacity",0)},10),$("body").removeClass("compact tour-active"),$("body").addClass("uncompact tour-active"),this._intro.setOptions(this.options),this._intro.onexit(function(targetElement){_this._stopTour(softScroll),onCompleteOrExit&&onCompleteOrExit.call()}),this._intro.oncomplete(function(targetElement){_this._stopTour(!0),onCompleteOrExit&&onCompleteOrExit.call()}),setTimeout(function(){_this._intro.start()},50)},_stopTour:function(soft){var _this=this;$(".btn-help");soft?setTimeout(function(){_this._hideButtonTooltip()},1e3):$("html, body").animate({scrollTop:0},200,function(){setTimeout(function(){_this._hideButtonTooltip()},1e3)})},_hideButtonTooltip:function(){$("body").removeClass("uncompact tour-active"),$(".btn-help").removeClass("animated bounce focus"),$(".btn-help").siblings(".tooltip").fadeOut(200)},_getSteps:function(steps){return _.isFunction(steps)?steps():steps},stop:function(){0<$(".introjs-overlay").length&&($(".introjs-tooltip").css("opacity","0"),this._intro.exit(),this._hideButtonTooltip())},start:function(steps,onChange,onCompleteOrExit){var _this=this;this.options.steps=steps,0<$(".introjs-overlay").length&&_this._intro.exit(),this._intro=introJs(),this._intro.refresh(),onChange&&this._intro.onbeforechange(onChange),1==this.options.steps[0].soft?this._startTour(this._intro,onCompleteOrExit,this.options.steps[0].soft):this._startTour(this._intro,onCompleteOrExit),window.qr.utils.cookie.set(this.name,"1"),$(".introjs-overlay").one("click",function(e){_this._stopTour(!0)})}},webroot+"/archive/recycle/id/"),deleteUrl=webroot+"/archive/delete/id/",archiveUrl=webroot+"/manage/movetoarchive/id/",massDeleteUrl=webroot+"/archive/delete",initialized=(extend(window.qr,"manage.lists"),window.qr.manage.lists={delay:400,init:function(){$("#cListViewWrapper").on("mouseover",".timeinformaiton",function(){$(".showtime.hidden",this).removeClass("hidden")}),$("#cListViewWrapper").on("mouseout",".timeinformaiton",function(){$(".showtime",this).addClass("hidden")}),$("#tracking_overview .qr-preview-overlay").on({mouseleave:function(){$(".icon-reset.reloadimage",$(this).parent()).stop().delay(2e3).fadeTo(500,0)},mouseenter:function(){$(".icon-reset.reloadimage",$(this).parent()).stop().fadeTo(500,1)}}),$(".icon-reset.reloadimage").click(function(e){e.preventDefault();var e=$(".qr-preview-overlay",$(this).parent()).css("opacity",1),$img=$(".qrcode_preview_image",$(this).parent());return $img.attr("src",$img.attr("temp-recreate")),e.stop().delay(2e3).fadeTo(500,0),!1}),window.qr.utils.events.register("newItemInList",function(){0<$(".recentlyAddedCode").length&&(window.qr.utils.cookie.get("qr_code"+$(".recentlyAddedCode").attr("added_time")+$(".recentlyAddedCode").attr("haslogo"))||(window.qr.utils.cookie.set("qr_code"+$(".recentlyAddedCode").attr("added_time")+$(".recentlyAddedCode").attr("haslogo"),1),1==$(".recentlyAddedCode").attr("dynamic")?window.qr.utils.trackUser.event("created_dynamic_codes"):window.qr.utils.trackUser.event("created_static_codes"),1==$(".recentlyAddedCode").attr("haslogo")&&window.qr.utils.trackUser.event("created_logo_code"),window.qr.utils.trackUser.event("created_code_type_"+$(".recentlyAddedCode").attr("type_id"))));$(".cListView").first().addClass("animated pulse "),_.delay(function(){$(".cListView").first().removeClass("animated pulse ")},1800)}),($("html").hasClass("oldie")||$("html").hasClass("ie9")||$("html").hasClass("ie8"))&&(this.delay=0),$(document).ready(this._onReady),this.refresh(),window.qr.utils.events.register("refreshList",this.refresh),this.initAdvancedOptions(),this.initPasteSanitization(),this._makeTitleEditable()},initPasteSanitization:function(){$(document).on("paste","[contenteditable]",function(e){e.preventDefault();e=(e.originalEvent||e).clipboardData.getData("text/plain")||prompt("Paste something..");document.execCommand("insertText",!1,e)})},initAdvancedOptions:function(){function _refresh(){setTimeout(function(){var value;value=!1,1==$(".listModeSimple #selectAllCheckbox:checked").length||1<=$(".listModeSimple input[type=checkbox]:checked").length||value?($("#summaryPlugin").addClass("in"),window.qr.utils.states.set("listItemsSelected",!1)):(_hideSelectOptions(),window.qr.utils.states.set("listItemsSelected",!0)),window.qr.utils.events.trigger("refreshUi")},0)}function _hideSelectOptions(){$("#summaryPlugin").removeClass("in")}$(document).on("click",".listItem.check",function(e){e.stopPropagation(),this.blur(),$(this).find("input").trigger("click")}),$(document).on("click change",".list-view input[type=checkbox]",function(e){e.stopPropagation(),$(this).prop("checked")?($(this).parent().parent().parent().addClass("selected"),$(this).parent().addClass("selected")):($(this).parent().parent().parent().removeClass("selected"),$(this).parent().removeClass("selected")),_refresh()}),window.qr.utils.events.register("listViewModeSimple refreshList",function(){_refresh()}),window.qr.utils.events.register("listViewModeDetail",function(){_hideSelectOptions(),window.qr.utils.events.trigger("refreshUi")})},_makeTitleEditable:function(){var requestSent=!1;function _cancel($this){_cleanup($this),$(".title-error").remove()}function _makeEditable($this){var input=$this.next();input.removeClass("hidden"),input.val($this.text().trim()),$this.addClass("editingMode"),$this.text($this.attr("title_edit")),$this.selectText(),requestSent=!1,$this.focus(),$this.parent().addClass("editing"),$this.on("keydown",function(e){13==e.keyCode?(e.preventDefault(),e.stopPropagation(),_save($this)):27==e.keyCode&&(e.preventDefault(),e.stopPropagation(),_cancel($this))})}function _cleanup($this){$(".title-error").remove(),$this.next().addClass("hidden"),$this.next().val(""),$this.removeClass("editingMode"),$this.off("keyup"),$this.parent().removeClass("editing")}function _save($this){$(".title-error").remove();var id,newText=$this.next().val();requestSent||(id=$this.attr("item-id"),$.ajax({url:"/manage/updateCodeTitle",type:"POST",data:{id:id,title:newText,YII_CSRF_TOKEN:GLOBAL_CSRF_TOKEN},dataType:"json",success:function(response){_cleanup($this),"error"==response.status?(_makeEditable($this),$this.parent().after("<div class='alert alert-error title-error'>"+response.message.title[0]+"</div>"),requestSent=!1):$(".titleSpan[item-id="+$this.attr("item-id")+"]").replaceWith(response.title)}}),requestSent=!0)}$(document).off("click"," .editTitle").on("click"," .editTitle",function(e){e.stopPropagation(),e.preventDefault(),_makeEditable($(".titleSpan",$(this).parent()))}),$(document).off("click"," .editTitleCancel").on("click"," .editTitleCancel",function(e){e.stopPropagation(),e.preventDefault(),_cancel($(this).siblings(".titleSpan"))}),$(document).off("click"," .editTitleOk").on("click"," .editTitleOk",function(e){requestSent=!1,e.stopPropagation(),_save($(this).siblings(".titleSpan"))}),$(document).on("click",".cListView  .titleSpan",function(e){if(e.stopPropagation(),$(this).hasClass("editingMode"))return!1;e=$(".action_tracking",$(this).parents(".resize-container")).attr("href");e&&window.top.location.assign(e)})},_onReady:function(){function _setListViewModeSimple(noCookie){$("#cListViewWrapper,#summaryPlugin").removeClass("listModeDetail").addClass("listModeSimple"),window.qr.utils.events.trigger("listViewModeSimple"),noCookie||$.cookie("listViewDetail","0",{path:"/",expires:1}),$(".switchListModeDetail").removeClass("active"),$(".switchListModeSimple").addClass("active")}function _setListViewModeDetail(){$(".switchListModeDetail").addClass("active"),$(".switchListModeSimple").removeClass("active"),$("#cListViewWrapper:not(.cList5Col),#summaryPlugin").addClass("listModeDetail").removeClass("listModeSimple"),window.qr.utils.events.trigger("listViewModeDetail"),$.cookie("listViewDetail","1",{path:"/",expires:360}),""==$(".cListView img").first().attr("src")&&$(document).trigger("refreshUi")}$(document).on("mousedown",".listItem.check",function(e){this.blur()}),$(document).on("click",".btn-group-actions a",function(e){e.stopPropagation()}),$(document).on("click",".btn-group-actions .btn",function(e){$(".cListView.active").removeClass("active"),($listItem=$(this).closest(".cListView")).addClass("active"),$(document).one("click",function(){$listItem.removeClass("active")})}),$(document).on("click",".switchListModeSimple",function(){window.qr.tour.stop(),_setListViewModeSimple()}).on("click",".switchListModeDetail",function(){window.qr.tour.stop(),_setListViewModeDetail()}),$(document).on("click",".cmn-toggle-list",function(){"checked"==$(this).attr("checked")?($("#scannerButton").addClass("disabled"),_setListViewModeSimple()):($("#scannerButton").removeClass("disabled"),_setListViewModeDetail())}),_setListViewModeDetail(),$(document).on("click",".selectAllCheckboxes",function(){window.qr.manage.lists.toggleChecked("checked"==$(".selectAllCheckboxes").attr("checked"))}),$(document).on("click",".listModeSimple .cListView, .listModeSimple .cListView .titleSpan",function(){($(this).hasClass("titleSpan")?$(".checkbox",$(this).parents(".listRow ")):$(".checkbox",$(this))).click()}),$("#search").on("mouseup keyup",function(){""!=$(this).val()?$(this).addClass("active"):$(this).removeClass("active")}),window.qr.manage.lists.refresh()},toggleChecked:function(status){$(".checkbox").each(function(){status?($(this).parent().parent().parent().addClass("selected"),$(this).parent().addClass("selected")):($(this).parent().parent().parent().removeClass("selected"),$(this).parent().removeClass("selected")),$(this).attr("checked",status)})},refresh:function(){$(document).trigger("refreshUi");function _showEmptyState(){0<$(".info-container").length&&($("#cListViewWrapper .empty").hide(),$(".info-container").show())}$(".cListView").each(function(i,c){$(this).css("z-index",999-i)}),$("#search").attr("emptytext")!=$("#search").val()?0<$(".info-container").length&&($(".info-container").hide(),$("#cListViewWrapper .empty").show()):0==$(".cListView").length&&_showEmptyState(),""==$("#search").val()&&0==$(".cListView").length&&_showEmptyState()}},extend(window.qr.manage,"lists.lazyloading"),window.qr.manage.lists.lazyloading={init:function(){function refreshCodePreviews(){var loaded,$w=$(window),th=20,$images=(window.devicePixelRatio,$(" .listModeDetail img, #tracking_overview img")),opts={lines:13,length:0,width:4,radius:20,corners:1,rotate:0,direction:1,color:"#000",speed:.9,trail:100,zIndex:2e9,top:0,left:0};function isvisible(){var inview=$images.filter(function(){var wt,wb,et,$e=$(this);if(!$e.is(":hidden"))return wt=$w.scrollTop(),wb=wt+$w.height(),et=$e.offset().top,$e=et+$e.height(),wt-th<=$e&&et<=wb+th});loaded=inview.trigger("isvisible"),$images=$images.not(loaded)}return $images.one("isvisible",function(){var $image=$(this),$container=$image.parent(),$overlay=$container.find(".qr-preview-overlay");$container.data("qrSpinner",new Spinner(opts)),$container.data("qrSpinner").spin($overlay[0]),$overlay.addClass("loading"),$image.attr("src",$image.attr("temp-src")),$image.off("error load").on("error",function(){""!=$image.attr("src")&&!function($image){$image.attr("src","/img/blank.png"),$image.attr("src",GLOBAL_API_ENDPOINT+"/v1/codes/"+$image.parent().attr("item-id")+"/refresh-image?access-token="+GLOBAL_API_TOKEN),0}($image)}).on("load",function(){setTimeout(function(){$overlay.removeClass("loading"),$image.addClass("loaded"),$container.data("qrSpinner")&&$container.data("qrSpinner").stop()},th)})}),$w.scroll(isvisible),$w.resize(isvisible),isvisible(),this}$(document).on("refreshUi",refreshCodePreviews),refreshCodePreviews()}},extend(window.qr.manage,"lists.titleEditing"),window.qr.manage.lists.titleEditing={init:function(){$(document).on("click",".editButton",function(){$(this).parent().find(".fileName").hide(),$(this).parent().find(".fileNameInput").show(),$(this).parent().find(".saveButton").show(),$(this).parent().find(".cancelButtonImage").show(),$(this).hide()}),$(document).on("click",".cancelButtonImage",function(){$(this).parent().find(".fileName").show(),$(this).parent().find(".fileNameInput").hide(),$(this).parent().find(".saveButton").hide(),$(this).parent().find(".editButton").show(),$(this).hide()}),$(document).on("click",".saveButton",function(){title=$(this).parent().find(".fileNameInput").val(),id=$(this).attr("title"),type=$(this).parent().find(".editButton").attr("title"),$.ajax({url:webroot+"/create/updateimagetitle",data:{title:title,id:id,type:type}}).done(function(data){window.qr.utils.checkJSON(data,!0);var item,data=$.parseJSON(data);"error"==data.status?alert(data.message,LABELS.errorDialogTitle):((item=$('span[title="'+data.imageId+'"]')).parent().find(".fileName").html(data.newTitle),item.parent().find(".fileNameInput").val(data.newTitle),item.parent().find(".fileName").show(),item.parent().find(".fileNameInput").hide(),item.parent().find(".cancelButtonImage").hide(),item.parent().find(".editButton").show(),item.hide())})})}},extend(window.qr.manage,"lists.actions"),window.qr.manage.lists.actions={init:function(){$(document).on("click",".restoreLink",function(evt){evt.preventDefault(),this.blur();var id=$(this).attr("id").split("_")[1],gridId=$(this).parents(".list-view").first().attr("id");confirm(LABELS.restoreDialogMessage,LABELS.dialogTitleConfirmation,function(result){result&&jQuery.ajax({type:"POST",data:{YII_CSRF_TOKEN:GLOBAL_CSRF_TOKEN},url:recycleUrl+id,cache:!1,success:function(html){window.qr.utils.checkJSON(html,!0);var result=$.parseJSON(html);"success"==result.status?$.fn.yiiListView.update(gridId):(html=$(result.message).html())?(result.limitedNumber&&0!=result.limitedNumber&&(html=html.replace("__LIMITEDNUMBER__",result.limitedNumber)),window.qr.utils.restrictionMessage(html)):alert(result.message,LABELS.accountDialogTitle)},error:function(html){$.fn.yiiListView.update(gridId)}})})}),$(document).on("click",".deleteLink",function(evt){this.blur();var id=$(this).attr("id").split("_")[1],gridId=$(this).parents(".list-view").first().attr("id");confirm(LABELS.deleteDialogMessage,LABELS.dialogTitleConfirmation,function(result){result&&jQuery.ajax({type:"POST",data:{YII_CSRF_TOKEN:GLOBAL_CSRF_TOKEN},url:deleteUrl+id,cache:!1,success:function(html){$.fn.yiiListView.update(gridId)},error:function(html){$.fn.yiiListView.update(gridId)}})})}),$(document).on("click",".archiveLink",function(evt){evt.preventDefault(),this.blur();var id=$(this).attr("id").split("_")[1],gridId=$(this).parents(".list-view").first().attr("id");$(this).parent().parent();confirm(LABELS.archiveDialogMessage,LABELS.dialogTitleConfirmation,function(result){result&&jQuery.ajax({type:"POST",data:{YII_CSRF_TOKEN:GLOBAL_CSRF_TOKEN},url:archiveUrl+id,cache:!1,success:function(html){_.isUndefined(gridId)?location.href="/manage":$.fn.yiiListView.update(gridId)},error:function(html){_.isUndefined(gridId)?location.href="/manage":$.fn.yiiListView.update(gridId)}})})})}},extend(window.qr.manage,"lists.search"),window.qr.manage.lists.search={init:function(){var ajaxUpdateTimeout,ajaxRequest;$(".qrCodeSearchInput").focus(function(){$(this).val()==$(this).attr("emptytext")&&$(this).val("")}),$(".qrCodeSearchInput").focusout(function(){""==$(this).val()&&$(this).val($(this).attr("emptytext"))}),$("input#search").keyup(function(){ajaxRequest=$(this).serialize(),clearTimeout(ajaxUpdateTimeout),ajaxUpdateTimeout=setTimeout(function(){$.fn.yiiListView.update("qrcode-model-grid",{data:ajaxRequest})},300)})}},extend(window.qr.manage,"lists.massdownload"),window.qr.manage.lists.massdownload={init:function(){$("#archiveLink").off("click").on("click",function(evt){evt.preventDefault(),$('.listItem.check input[type="checkbox"]:checked').size()?confirm(LABELS.archiveDialogMessage,LABELS.dialogTitleConfirmation,function(result){result&&window.qr.utils.submitForm($("#manage-form"),function(response){$.fn.yiiListView.update("qrcode-model-grid")},function(response){$.fn.yiiListView.update("qrcode-model-grid")})}):alert(LABELS.noQrcodesSelected,LABELS.genericTitleNotice)}),$("#restoreLink").off("click").on("click",function(evt){evt.preventDefault(),$('.listItem.check input[type="checkbox"]:checked').size()?confirm(LABELS.restoreDialogMessage,LABELS.dialogTitleConfirmation,function(result){result&&window.qr.utils.submitForm($("#manage-form"),function(response){window.qr.utils.checkJSON(response,!0);response=$.parseJSON(response);"error"==response.status&&((html=$(response.message).html())?(response.limitedNumber&&0!=response.limitedNumber&&(html=html.replace("__LIMITEDNUMBER__",response.limitedNumber)),window.qr.utils.restrictionMessage(html)):alert(response.message,LABELS.accountDialogTitle)),$.fn.yiiListView.update("qrcode-model-grid")},function(response){$.fn.yiiListView.update("qrcode-model-grid")})}):alert(LABELS.noQrcodesSelected,LABELS.genericTitleNotice)}),$("#massDelete").on("click",function(evt){evt.preventDefault(),$('.listItem.check input[type="checkbox"]:checked').size()?confirm(LABELS.massDeleteDialogMessage,LABELS.dialogTitleConfirmation,function(result){var ids;result&&(result=$('.listItem.check input[type="checkbox"]:checked'),ids={list:new Array},result.each(function(index,elm){ids.list.push($(elm).val())}),result=massDeleteUrl+"?"+$.param(ids),$.ajax({url:result,type:"get",success:function(){$.fn.yiiListView.update("qrcode-model-grid")},error:function(){$.fn.yiiListView.update("qrcode-model-grid")}}))}):alert(LABELS.noQrcodesSelected,LABELS.genericTitleNotice)}),$("#downloadAdvancedButton").on("click",function(){0==$("#advancedAccessAllowed").val()?alert(LABELS.featureRestricted,LABELS.accountDialogTitle):$("#advancedDownloadContainer").first()}),$("#downloadCancelButton").on("click",function(){$("#advancedDownloadContainer").first(),$("#downloadAdvancedButton")}),$("#formatSelect").change(function(){var option=$(this).find("option:selected");option.hasClass("allowed")||((option=$(this).find("option").first()).attr("selected",!0),alert(LABELS.featureRestricted,LABELS.accountDialogTitle))}),this.initColorpickers()},initColorpickers:function(){$("#massDownloadFrontColor").colorpicker(),$("#massDownloadBackColor").colorpicker()}},extend(window.qr.manage,"scans"),!(window.qr.manage.scans={counter:0,scans_current:!1,active:!1,listen:function(){that=this,window.setTimeout(function(){if(0==that.active||25<that.counter)return!1;that.counter++,window.qr.manage.scans.check(),that.listen()},5e3)},check:function(){$.get("/manage/checkforscans",function(data){!1===qr.manage.scans.scans_current&&(qr.manage.scans.scans_current=data.scans),data.scans!=qr.manage.scans.scans_current&&(qr.manage.scans.scans_current=data.scans,$("#qrcode-model-grid").addClass("updateScans"),$.fn.yiiListView.update("qrcode-model-grid",{complete:function(){$("#qrcode-model-grid").removeClass("updateScans"),1==data.scans?(window.qr.tour.start(steps.firstScan),window.qr.utils.trackUser.event("done_first_scan_on_manage")):window.qr.tour.stop()}}),$(".spinner-overlay").hide(),window.qr.utils.trackUser.event("done_scan_on_manage"))},"json").fail(function(){location.reload()})}})),fixScrolling=($(document).ready(function(){initialized||(initialized=!0,"ontouchstart"in document.documentElement&&$("#scannerButton").hide(),window.qr.manage.scans.listen(),window.qr.manage.lists.init(),window.qr.manage.lists.search.init(),window.qr.manage.lists.lazyloading.init(),window.qr.manage.lists.actions.init(),window.qr.manage.lists.massdownload.init())}),extend(window,"qr.CONSTANTS"),window.qr.CONSTANTS.GENERATOR_STATES_CSS=["state-generator-codetype","state-generator-data","state-generator-design"],window.qr.CONSTANTS.GENERATOR_STATES=["codeTypeChooser","codeForm","designer"],extend(window.qr,"generator"),window.qr.generator={currentIndex:0,$carousel:!1,scenario:"add",hoveredElements:0,formLoading:!1,spinbuttonSave:!1,spinbuttonNext:!1,beforeInit:function(){window.qr.utils.events.block("updateQRCode"),window.qr.utils.events.block("stateChanged"),window.qr.utils.events.block("updateQRCodeData"),$("#formHere,.designer-view").on("mousemove",".upload",function(e){var offL=$(this).offset().left,offT=$(this).offset().top;aaa=$(this).find("input[type='file']").width(),$(this).find("input[type='file']").css({left:e.pageX-offL-aaa+30,top:e.pageY-offT-10})})},afterInit:function(){window.qr.utils.events.unblock("updateQRCode"),window.qr.utils.events.unblock("stateChanged"),window.qr.utils.events.unblock("updateQRCodeData"),window.qr.generator.spinbuttonSave=new window.qr.utils.ui.Spinbutton({selector:".btn-generator-save-directly"}),window.qr.generator.spinbuttonNext=new window.qr.utils.ui.Spinbutton({selector:".btn_create_next"})},intendCodeTypeSelection:function(){$(".apply-fixedBottom-footerGenerator").hover(function(){})},init:function(scenario){this.beforeInit();this.checkForDeeplink(),this.initCarousel(),this.initInputFeatures(),this.initCodeTypeChooser(),this.initTooltips(),this.intendCodeTypeSelection(),this.form.init();(new window.qr.generator.livepreview).init(),window.qr.generator.preview.init(),this.$carousel=$(".carousel"),window.qr.utils.makeTogglable(".btn-toggle-row, .btn-toggle-content"),window.qr.utils.code.factory.getModel(),$(".btn-generator-save-directly, .btn-generator-save").on("click",function(){window.qr.utils.states.set("saveAsDraft",!1),window.qr.utils.states.set("saveCodeDirectly",!0),window.qr.generator.spinbuttonSave.startLoad();var selectedQrCodeType=$(".row-generator-codetype-chooser .btn-codetype.active"),isQrCodeDynamic=1==$(".trackableIndicator").attr("value"),qrCodeTypeIdFormatted=new URL(location.href).searchParams.get("codeId");selectedQrCodeType.length&&(qrCodeTypeIdFormatted=(selectedQrCodeType=selectedQrCodeType.attr("id")).substring(selectedQrCodeType.lastIndexOf("_")+1)),$(".angularWrapper .ng-invalid").length||$(".angularWrapper .box-input.error").length?(window.qr.utils.snowplow.trackCreateQrCodeNextButtonClicked({qr_code_type_id:qrCodeTypeIdFormatted,error:!0}),_submit()):(window.qr.utils.snowplow.trackCreateQrCodeNextButtonClicked({qr_code_type_id:qrCodeTypeIdFormatted,error:!1}),_submit(),$("[name=yt0]").click(),0<=(selectedQrCodeType=$(".card--demo-selected").attr("data-type-id"))&&window.dataLayer.push({event:"created_recommendation_code",created_qr_code_recommendation:selectedQrCodeType}),isQrCodeDynamic?window.qr.utils.optimizely.trackOptimizelyEvent("qrapp_created_dynamic_code"):window.qr.utils.optimizely.trackOptimizelyEvent("qrapp_created_static_code"))}),$(".btn-generator-edit-save,.btn-generator-design-save").on("click",function(){if(window.qr.utils.states.set("saveCodeAfterEditing",!0),0<$("body").find("input.ng-invalid").length)for(var i=0;i<$("body").find("input.ng-invalid").length;i++){var elem=$("body").find("input.ng-invalid")[i],section=$(elem).parents(".section-body");$(section).is(":visible")||($(section.parents(".formly-field")[1]).find("input[type='checkbox']").prop("checked",!1),$(section.parents(".formly-field")[1]).find(".section-header").toggleClass("section-open"),section.stop().slideToggle(200),setTimeout(function(){section.css({overflow:"initial"})},201))}$(".angularWrapper .ng-invalid").length||$(".angularWrapper .box-input.error").length?_submit():(_submit(),$("[name=yt0]").click(),window.qr.utils.optimizely.trackOptimizelyEvent("qrapp_edited_qr_code"))}),window.qr.utils.events.register("submitCode",function(event,codetype){_submit()}),window.qr.utils.events.register("changeCodeTypeOnEdit",function(event,codetype){var id=0;$("#oldCodeId").size()&&""!=$("#oldCodeId").text()?id=$("#oldCodeId").text():$("#oldCodeId").size()&&(id=$("#oldCodeId").val()),1==window.qr.utils.states.get("saveAsDraft")?_loadForm(codetype,0):_loadForm(codetype,id)}),"add"==scenario?(window.qr.utils.states.set("scenario","add"),this._initAddScenario()):"edit"==scenario&&(window.qr.utils.states.set("scenario","edit"),this._initEditScenario(),$("#progress-bar-top").attr("style","display: none !important")),$("img.lazy_designer").lazyload({event:"load_designer_images"}),""==$("#barcodeImage").attr("src")&&(0<$("#oldCodeId").val()?(scenario=GLOBAL_API_ENDPOINT+"/v1/create?access-token="+GLOBAL_API_TOKEN,scenario=(scenario+="&frame_name=no-frame&image_format=PNG&image_width=500&qr_code_id="+$("#oldCodeId").val())+"&rnd="+(new Date).getTime(),$("#barcodeImage").attr("src",scenario)):$("#barcodeImage").attr("src","/img/qrcode_placeholder.png"));var formLoading=!1;function _loadForm(codetype,id){formLoading||(formLoading=!0,$("#formHere").addClass("loading").html(""),$.get(function(codetype){return $("[data-type="+codetype+"]").attr("loadurl")}(codetype),{currentCodeId:id,qr_demo_id:0,industry_id:0},function(response){$("#formHere form").remove(),$("#formHere").removeClass("loading").append(response),$(".itemId").attr("value",id),window.qr.utils.events.trigger("afterFormLoad",codetype),formLoading=!1},"html").fail(function(response){window.qr.utils.events.trigger("errorFormLoad"),window.qr.utils.checkJSON(response.responseText,!0),window.qr.utils.loader.hide("#formHere"),formLoading=!1}))}function _submit(){$(".angularWrapper .ng-invalid").length||$(".angularWrapper .box-input.error").length?($.each($(".angularWrapper .canHaveError.ng-invalid"),function(key,element){$(element).parent().addClass("error"),errorMessage=$(".errorHolder",$(element).parents(".formly-field")),window.qr.utils.formValidationTooltip(errorMessage.attr("data-error-container"),errorMessage.attr("data-error-msg"),!0,!0),$(".mockup__qrcode").addClass("barCodeError")}),_.delay(function(){window.qr.utils.events.trigger("formNotValid")},100),_.delay(function(){window.qr.generator.spinbuttonSave.stopLoad()},250),$("[data-generate-mobile-bar] li:nth-child(2)").trigger("click")):($(".mockup__qrcode ").removeClass("barCodeError"),$("[data-placeholder-active=true]").val(""))}},_initAddScenario:function(){var _this=this,$buttons=(window.qr.utils.states.get("firstTimeActivation")?window.qr.utils.scrollTo($(".main-header")):window.qr.utils.scrollTo($(".bs-wizard")),window.qr.utils.events.register("generatorNextStep",function(){_this.nextStep()}),window.qr.utils.states.set("generatorState","codeTypeChooser"),$(".row-generator-codetype-chooser .btn-codetype")),footerGeneratorStyle=($buttons.on("click",function(){var codetype;$("body").hasClass("ab-test-new-smartphone-previews")&&$(this).attr("data-new")||(codetype=$(this).attr("data-type"),window.qr.utils.events.trigger("changeCodeType",codetype),$(".btn-generator-next").removeClass("disabled"))}),""),spinbuttonSaveLeft=(0<$(".apply-fixedBottom-footerGenerator").length&&(footerGeneratorStyle=".apply-fixedBottom-footerGenerator .generator-float-bottom"),0<$(".apply-normal-footerGenerator").length&&(footerGeneratorStyle=".apply-normal-footerGenerator .generator-float-normal"),new window.qr.utils.ui.Spinbutton({selector:footerGeneratorStyle+" .btn-generator-done"}),new window.qr.utils.ui.Spinbutton({selector:footerGeneratorStyle+" .download-save-btn-left"})),spinbuttonSaveRight=new window.qr.utils.ui.Spinbutton({selector:footerGeneratorStyle+" .download-save-btn-right"});$(".btn-generator-done").click(function(){window.qr.generator.spinbuttonSave.startLoad(),spinbuttonSaveLeft.startLoad(),"function"==typeof spinbuttonSaveRight.startLoad&&spinbuttonSaveRight.startLoad()}),window.qr.utils.events.register("formNotValid generatorFormError",function(eventName,value){_.delay(function(){window.qr.generator.spinbuttonSave.stopLoad()},250),$(".btn-generator-next").removeClass("disabled"),$(".btn-generator-save").removeClass("disabled")}),window.qr.utils.events.register("generatorSlide",function(){$(".btn-generator-next").addClass("disabled")}),window.qr.utils.events.register("generatorSlideFinished",function(){$(".btn-generator-next").removeClass("disabled")}),window.qr.utils.events.trigger("changeCodeType","url"),0<$("body.no-default").length&&($(".btn-generator-next").addClass("disabled"),$buttons.removeClass("active"),window.qr.utils.events.trigger("changeCodeType",!1),window.qr.utils.events.trigger("setPlaceholderImage",!1))},_initEditScenario:function(){var initialSelectboxValue,spinbuttonSave,_this=this;$("#select-codetypes-input").change(function(){$(".editMode").addClass("switchMode"),window.qr.utils.events.trigger("generatorRemoveValidation");var codetype=$("option:selected",this).attr("data-type");window.qr.utils.events.trigger("changeCodeTypeOnEdit",codetype),window.qr.utils.events.trigger("setCodeTypeAndTemplate",codetype),window.qr.utils.events.trigger("generatorFormChanged")}),initialSelectboxValue=$("#select-codetypes-input option:selected").val(),spinbuttonSave=new window.qr.utils.ui.Spinbutton({selector:".btn-generator-edit-save"}),$(".btn-generator-edit-save").click(spinbuttonSave.startLoad),$(".btn-generator-edit-save").addClass("disabled"),_.delay(function(){window.qr.utils.events.register("generatorFormChanged",function(eventName,value){$(".btn-generator-edit-save").removeClass("disabled")}),window.qr.utils.events.register("formNotValid generatorFormError",function(eventName,value){_.delay(function(){spinbuttonSave.stopLoad()},250)}),window.qr.utils.events.register("generatorFormSaved",function(eventName,value){$(".btn-generator-edit-save").addClass("disabled"),_.delay(function(){spinbuttonSave.stopLoad()},250),_this.showSaveMessage()})},600),$("#btn-edit-codetypes-abort").on("click",function(){$("#select-codetypes-input option[value='"+initialSelectboxValue+"']").attr("selected",!0).trigger("change")}),window.qr.utils.states.set("generatorState","codeForm")},showSaveMessage:function(){767<window.innerWidth&&($(".message-feedback").addClass("in"),$(".btn-generator-prev").addClass("hidden"),_.delay(function(){$(".message-feedback").removeClass("in"),$(".btn-generator-prev").removeClass("hidden")},5e3))},initTooltips:function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})},initCodeTypeChooser:function(){$buttons=$(".row-generator-codetype-chooser .btn-codetype"),$(".row-generator-codetype-chooser .btn-codetype .icon-next").on("click",function(){window.qr.utils.events.trigger("setPlaceholderImage",$(this).parent().attr("data-type"))}),$buttons.on("click",function(e){var type;$("body").hasClass("ab-test-new-smartphone-previews")&&$(this).attr("data-new")||($buttons.removeClass("active"),$("[data-demo-card]").removeClass("card--demo-selected"),$(this).addClass("active"),type=$(this).attr("data-type"),"true"==$(this).attr("has-video")?window.qr.utils.events.trigger("setPlaceholderVideo",type):window.qr.utils.events.trigger("setPlaceholderImage",type),window.qr.generator.hoveredElements=0)}),0<$(".addMode").length&&$("#footer").css({display:"none"})},loadCodeForm:function(codeId,demoId,industryId){function _loadForm(codetype,id){if(!window.qr.generator.formLoading)if(window.qr.generator.formLoading=!0,$("#formHere").addClass("loading").html(""),codeId){var codetypeURL;switch(codeId){case"1":codetypeURL="/create/getform/add/url";break;case"1-static":codetypeURL="/create/getform/add/url?action=static";break;case"14":codetypeURL="/create/getform/add/dsocial";break;case"18":codetypeURL="/create/getform/add/coupon";break;case"12":codetypeURL="/create/getform/add/angular";break;case"15":codetypeURL="/create/getform/add/dbusiness_page";break;case"17":codetypeURL="/create/getform/add/feedback";break;case"19":codetypeURL="/create/getform/add/drating";break;case"16":codetypeURL="/create/getform/add/dvideo";break;case"13":codetypeURL="/create/getform/add/devent";break;case"20":codetypeURL="/create/getform/add/dpdf";break;case"4":codetypeURL="/create/getform/add/facebook";break;case"21":codetypeURL="/create/getform/add/dapp";break;case"22":codetypeURL="/create/getform/add/dmp3";break;case"23":codetypeURL="/create/getform/add/dgallery";break;case"11":codetypeURL="/create/getform/add/url_criteria";break;case"25":codetypeURL="/create/getform/add/instagram";break;case"26":codetypeURL="/create/getform/add/gs1";break;case"2":codetypeURL="/create/getform/add/vcard";break;case"8":codetypeURL="/create/getform/add/email";break;case"9":codetypeURL="/create/getform/add/sms";break;case"10":codetypeURL="/create/getform/add/text";break;case"24":codetypeURL="/create/getform/add/wifi";break;default:codetypeURL="/create/getform/add/url"}$.get(codetypeURL,{currentCodeId:id,qr_demo_id:demoId||0,industry_id:industryId||0},function(response){_initFormSuccessState(response)},"html").fail(function(response){_initFormFailedState(response)})}else $.get(function(codetype){return $("[data-type="+codetype+"]").attr("loadurl")}(codetype),{currentCodeId:id,qr_demo_id:$(".card--demo-selected").attr("data-demo-id")||$(".btn-codetype.active").attr("data-demo-id")||0,industry_id:$(".search__suggest-item--active").attr("data-industry-id")||$("[data-user-industry]").attr("data-user-industry")||0},function(response){_initFormSuccessState(response)},"html").fail(function(response){_initFormFailedState(response)})}function _initFormSuccessState(response){var form=$("#formHere");form.find("form").remove(),form.removeClass("loading"),form.append(response),$(".itemId").attr("value",id),window.qr.utils.events.trigger("afterFormLoad",codetype),window.qr.generator.formLoading=!1}function _initFormFailedState(response){window.qr.utils.events.trigger("errorFormLoad"),window.qr.utils.checkJSON(response.responseText,!0),window.qr.generator.formLoading=!1}var codetype,trackable,qrcode_type_id,qrcode_demo_id=$(".card--demo-selected").attr("data-demo-id")||0;if(0<$(".btn-codetype.active").length)codetype=$(".btn-codetype.active").attr("data-type"),trackable=$(".dynamiccodes .btn-codetype.active").length,qrcode_type_id=$(".btn-codetype.active").attr("id").replace(/[^0-9]/g,"");else{if(!(0<$(".card--demo-selected").length))return!1;qrcode_type_id=$(".card--demo-selected").attr("data-type-id"),trackable=1,codetype=$("#codeFormId_"+qrcode_type_id).attr("data-type")}var current_qrcode_type_id=$("[id$='_qrcode_type_id']").val(),current_qrcode_demo_id=$("[id$='_qr_demo_id']").val()||0,current_trackable=$("[id$=_trackable]").val(),loadForm=!0,id=(current_qrcode_type_id==qrcode_type_id&&current_trackable==trackable&&current_qrcode_demo_id==qrcode_demo_id&&(loadForm=!1),0);$("#oldCodeId").size()&&""!=$("#oldCodeId").text()?id=$("#oldCodeId").text():$("#oldCodeId").size()&&(id=$("#oldCodeId").val()),loadForm&&(!0===window.qr.utils.states.get("saveAsDraft")?_loadForm(codetype,0):_loadForm(codetype,id)),$("img.lazy_designer").trigger("load_designer_images")},checkForDeeplink:function(){var _this=this,url_string=window.location.href,url_string=new URL(url_string),codeId=url_string.searchParams.get("codeId"),demoId=url_string.searchParams.get("demoId"),url_string=url_string.searchParams.get("industryId");codeId&&(window.qr.generator.loadCodeForm(codeId,demoId,url_string),function checkIframeLoaded(){if($.trim($(".angularWrapper").html()).length)return window.qr.generator.spinbuttonNext.stopLoad(),void _.delay(function(){_this.nextStep(),$(".codetype-view, .data__mockup ").removeClass("disableAction")},100);window.setTimeout(checkIframeLoaded,100)}(),$(".codetype-view, .data__mockup ").addClass("disableAction"),$("#progress-bar-top").attr("style","display: none !important"),$(".row-generator-codetype-chooser .btn-codetype.active").hasClass("cachedTemplate")||$(".row-generator-codetype-chooser .card.card--demo-selected").hasClass("cachedTemplate")||($(".row-generator-codetype-chooser .btn-codetype").removeClass("cachedTemplate"),$(".row-generator-codetype-chooser .btn-codetype.active").addClass("cachedTemplate"),$(".row-generator-codetype-chooser .card").removeClass("cachedTemplate"),$(".row-generator-codetype-chooser .card.card--demo-selected").addClass("cachedTemplate")),$(".qr-navbar__menu__back-button").addClass("hiddenAbsolute"),$("body").addClass("force-scroll"),window.setTimeout(function(){$(".mockup__preview").addClass("active"),$(".preview-smartphone-wrapper").attr("style","display: block !important")},100))},initCarousel:function(){var _this=this;$(".carousel").carousel({interval:!1}),$(".carousel").on("slide.bs.carousel",function(e){return window.qr.utils.events.trigger("generatorSlide"),0!=function(index){if(2==index)return!1;$("[class*='step-description-']").animate({opacity:0}).addClass("hidden"),1==index&&window.qr.generator.loadCodeForm();$(".newgenerator").removeClass(function(index,css){return(css.match(/\sstate-generator\S+/g)||[]).join(" ")}).addClass(window.qr.CONSTANTS.GENERATOR_STATES_CSS[index]),0<$(".addMode").length&&$("#footer").css({display:"none"});return!0}(_this.currentIndex)&&($(this).addClass("fadeOutDown"),$(".btn-slide-toggler").show(),!0)}).on("slid.bs.carousel",function(e){$(this).removeClass("fadeOutDown");var index=_this.currentIndex,isHintVisible=$(".section-title").hasClass("section-title--backdrop");return""===$("[data-title-input]").val()&&(isHintVisible?(_.delay(function(){$("body").addClass("hint--disable-scrolling"),$("[data-title-icon]").addClass("icon--title-editing-animation"),$("[data-title-input]").addClass("input--title-editing-animation"),$("[data-feature-hint]").addClass("feature-hint-animation")},1e3),_.delay(function(){},1e3)):_.delay(function(){},100)),$(".carousel-inner").css("height","auto"),$(".step-description-"+index).removeClass("hidden").animate({opacity:1}),"codeTypeChooser"==window.qr.generator.getCurrentIndex(!0)?(_this.preview.showSmartphone(),$(".btn-slide-toggler").hide()):"codeForm"==window.qr.generator.getCurrentIndex(!0)?($(".btn-slide-toggler").fadeIn(),_this.preview.showSmartphone()):"designer"==window.qr.generator.getCurrentIndex(!0)&&($(".btn-slide-toggler").show(),_this.preview.showQRCode(),window.qr.utils.events.unblock("updateQRCode"),$("#formHere form").addClass("dirty")),$("[data-generator-step='"+index+"']").addClass("active"),window.qr.utils.states.get("firstTimeActivation")?window.qr.utils.scrollTo($(".main-header")):window.qr.utils.scrollTo($(".bs-wizard")),window.qr.utils.events.trigger("generatorSlideFinished",_this.currentIndex),!1}).off("keydown.bs.carousel"),$(".btn-generator-next").click(function(){window.qr.generator.spinbuttonNext.startLoad(),$(".codetype-view, .data__mockup ").addClass("disableAction"),$("#progress-bar-top").attr("style","display: none !important"),$(".row-generator-codetype-chooser .btn-codetype.active").hasClass("cachedTemplate")||$(".row-generator-codetype-chooser .card.card--demo-selected").hasClass("cachedTemplate")||($(".row-generator-codetype-chooser .btn-codetype").removeClass("cachedTemplate"),$(".row-generator-codetype-chooser .btn-codetype.active").addClass("cachedTemplate"),$(".row-generator-codetype-chooser .card").removeClass("cachedTemplate"),$(".row-generator-codetype-chooser .card.card--demo-selected").addClass("cachedTemplate")),$(".qr-navbar__menu__back-button").addClass("hiddenAbsolute"),$("body").addClass("force-scroll");var selectedQrCodeType=$(".row-generator-codetype-chooser .btn-codetype.active"),qrCodeType=selectedQrCodeType.attr("data-type"),isQrCodeDynamic=1==selectedQrCodeType.attr("data-trackable"),qrCodeRecommendation=$(".card--demo-selected").attr("data-type-id");switch(qr.generator.getCurrentIndex(!0)){case"codeTypeChooser":"url"!==qrCodeType&&$(".template-url").remove(),window.qr.generator.loadCodeForm(),!function checkIframeLoaded(){$.trim($(".angularWrapper").html()).length?(window.qr.generator.spinbuttonNext.stopLoad(),_.delay(function(){_this.nextStep(),$(".codetype-view, .data__mockup ").removeClass("disableAction")},100)):window.setTimeout(checkIframeLoaded,100)}(),window.dataLayer.push({event:"click_first_next",selected_qr_code:qrCodeType,selected_qr_code_recommendation:qrCodeRecommendation}),isQrCodeDynamic?window.qr.utils.optimizely.trackOptimizelyEvent("qrapp_selected_dynamic_code"):window.qr.utils.optimizely.trackOptimizelyEvent("qrapp_selected_static_code");break;case"codeForm":window.qr.utils.events.trigger("submitCode")}}),$(".btn-generator-prev").click(function(){$(".qr-navbar__menu__back-button").removeClass("hiddenAbsolute"),$("body").removeClass("force-scroll"),$("#progress-bar-top").attr("style","display: block !important"),$("[data-backdrop-overlay]").removeAttr("style"),$(".data__mockup").addClass("data__mockup_fade"),$(".preview-smartphone").removeClass("animation_none"),$(".download-new-design").removeClass("show-button-left"),_this.prevStep();var url_string=window.location.href,url_string=new URL(url_string).searchParams.get("codeId");url_string&&!function(codeId){$("#codeFormId_"+codeId).click()}(url_string)})},prevStep:function(){this.setStateByIndex(this.currentIndex-1)},nextStep:function(){1!=this.currentIndex&&this.setStateByIndex(this.currentIndex+1)},goTo:function(index){_.isString(index)&&(index=_.indexOf(window.qr.CONSTANTS.GENERATOR_STATES,index)),this.setStateByIndex(index)},getCurrentIndex:function(asString){return 1==asString?window.qr.CONSTANTS.GENERATOR_STATES[this.currentIndex]:this.currentIndex},setStateByIndex:function(index){this.currentIndex=index=1<index?1:index,window.qr.utils.events.trigger("generatorStateChanged"),window.qr.utils.states.set("generatorState",window.qr.CONSTANTS.GENERATOR_STATES[index]),this.currentIndex=index,this.$carousel.carousel(index)},initInputFeatures:function(){$(".newgenerator").on("focus"," .col-form-b input, .col-form-b textarea, .col-form-b select, .col-form-b button",function(){$(".row-generator-form.active").removeClass("active"),$(this).closest(".row-generator-form").addClass("active")}).on("blur",function(){$(".row-generator-form.active").removeClass("active")})},form:{init:function(){window.qr.utils.events.register("generatorSlide",function(){$(".popover").popover("destroy")}),$(document).on("change","input[type=checkbox]",function(){window.qr.utils.events.trigger("generatorFormChanged")});var debouncedTyping=_.debounce(function(){window.qr.utils.events.trigger("generatorFormChanged")},200);$(".newgenerator").on("keyup","input, textarea",function(){debouncedTyping()}),$(document).on("focusout","#formHere input",function(){window.setTimeout(function(){window.qr.utils.events.trigger("generatorFormLostFocus")},200)}),window.qr.utils.events.register("generatorFormLostFocus",function(eventName,value){$("input[id$='qrcode_title_0']").length&&$("input[id$='_title']:eq(0)").attr("value",$("input[id$='qrcode_title_0']").val()),$.each($("#formHere input"),function(i,input){var $parentElement,elementSelector,errorMsg;"form-tooltip"!=$(this).attr("rel")&&($parentElement=$(input).parent(),elementSelector="#"+$(input).attr("id"),$parentElement.hasClass("error")&&(window.qr.generator.spinbuttonSave.stopLoad(),errorMsg=$(".errorMessage",$parentElement).text(),"codeForm"==window.qr.utils.states.get("generatorState")&&""!==$(input).val()&&window.qr.utils.formValidationTooltip(elementSelector,errorMsg,!0)),$parentElement.hasClass("success")&&((input=$(elementSelector).attr("data-error-container"))?$(input):$(elementSelector)).popover("destroy"))})})}}},function(){var scroll=$(window).scrollLeft();$(".generator-float-bottom, .data__mockup").css("margin-left",-scroll)}),blockSubmitCodeType=($(document).ready(function(){fixScrolling(),$(window).scroll(function(){fixScrolling()})}),extend(window.qr,"generator.forms"),window.qr.generator.forms={init:function(){window.qr.utils.events.register("formNotValid",function(e,data){_.delay(function(){window.qr.generator.spinbuttonSave.stopLoad()},100),window.qr.utils.states.set("saveCodeDirectly",!1),window.qr.utils.states.set("isFormValid",!1)}),$(window).on("resize",function(){$(".popover").popover("destroy")}),window.qr.utils.events.register("formValid",function(e,data){$(".popover").popover("destroy"),$("#formHere div").removeClass("error"),window.qr.utils.states.set("isFormValid",!0)})}},$(document).ready(function(){window.qr.generator.forms.init()}),window.qr.generator.forms.designerForm={afterValidateCallback:function(form,data,hasError){window.qr.utils.events.trigger("updateQRCode")},afterValidateAttributeCallback:function(form,attribute,data,hasError){window.qr.utils.events.trigger("updateQRCode")}},!(window.qr.generator.forms.basicErrorHandling={beforeValidateCallback:function(form){return window.qr.utils.events.trigger(form.attr("id")+".validation.start",form),!0},afterValidateCallback:function(form,data,hasError){if(window.qr.utils.events.trigger(form.attr("id")+".validation.end",form),hasError){for(prop in data)field="#"+(field=prop),text=$(field+"_em_").text(),window.qr.utils.formValidationTooltip(field,text,hasError);window.qr.utils.events.trigger(form.attr("id")+".validation.failed",form)}else window.qr.utils.events.trigger(form.attr("id")+".validation.success",form);return!1},afterValidateAttributeCallback:function(form,attribute,data,hasError){var field,text;if(hasError)for(prop in data)field="#"+prop,text=$(field+"_em_").text(),window.qr.utils.formValidationTooltip(field,text,hasError);else window.qr.utils.removeFormValidationTooltip(".row.success .popover");return 1!=hasError}})),debounceQRCode=(window.qr.generator.forms.codeTypeDynamic={submitStatus:function(){return globalSubmit},afterValidateAttributeCallback:function(form,attribute,data,hasError){var field=!1,text=!1;if(!0===attribute){if(hasError)for(prop in data)field="#"+(field=prop),text=$(field+"_em_").text(),"codeForm"==window.qr.utils.states.get("generatorState")&&window.qr.utils.formValidationTooltip(field,text,hasError)}else""!==(field=attribute.hasOwnProperty("id")?attribute.id:"")&&(text=data.hasOwnProperty(field)?data[field]:"",field="#"+field),"codeForm"==window.qr.utils.states.get("generatorState")&&window.qr.utils.formValidationTooltip(field,text,hasError);return 1!=hasError},beforeValidateCallback:function(form,data,hasError){return window.qr.utils.code.factory.getModel().hasAjaxValidation(!1),!0},afterValidateCallback:function(form,data,hasError){if(hasError||blockSubmitCodeType)window.qr.utils.events.trigger("formNotValid"),$(".popover").popover("destroy"),(window.qr.utils.code.factory.getModel().hasAjaxValidation()?window.qr.generator.forms.codeTypeDynamicWithAjax:window.qr.generator.forms.codeTypeDynamic).afterValidateAttributeCallback(form,!0,data,hasError);else{if(blockSubmitCodeType=!0,window.qr.utils.events.trigger("formValid"),window.qr.utils.events.block("updateQRCode"),("codeForm"==window.qr.generator.getCurrentIndex(!0)||"edit"==window.qr.utils.states.get("scenario")||"design"==window.qr.utils.states.get("scenario"))&&($(".popover").popover("destroy"),blockSubmitCodeType=!1,window.qr.utils.states.set("dontRedirectAfterSubmitting",!1),window.qr.utils.states.set("cleanSessionDesignerQRCodeImage",!1),!window.qr.utils.states.get("saveCodeDirectly")))if("add"==window.qr.utils.states.get("scenario"))window.qr.utils.states.set("dontRedirectAfterSubmitting",!0),window.qr.utils.states.set("saveAsDraft",!0);else if(("edit"==window.qr.utils.states.get("scenario")||"design"==window.qr.utils.states.get("scenario"))&&0==window.qr.utils.states.get("isEditingAllowed"))return window.qr.utils.events.trigger("formNotValid"),window.qr.utils.restrictionMessage($("#editingOfQRCodesIsNotAllowed").html()),!1;window.qr.utils.code.factory.getModel().submitForm(form,function(response){window.qr.utils.code.factory.getModel().handleResponse({response:response}),window.qr.utils.events.unblock("updateQRCode"),blockSubmitCodeType=!1},function(response){window.qr.utils.events.unblock("updateQRCode"),blockSubmitCodeType=!1})}return!1}},window.qr.generator.forms.codeTypeDynamicWithAjax={beforeValidateCallback:function(form,data,hasError){return returnValue=window.qr.generator.forms.codeTypeDynamic.beforeValidateCallback(form,data,hasError),window.qr.utils.code.factory.getModel().hasAjaxValidation(!0),returnValue},afterValidateCallback:function(form,data,hasError){return window.qr.generator.forms.codeTypeDynamic.afterValidateCallback(form,data,hasError)},afterValidateAttributeCallback:function(form,attribute,data,hasError){return window.qr.generator.forms.codeTypeDynamic.afterValidateAttributeCallback(form,!0,data,hasError)}},window.qr.generator.forms.codeTypeStatic={beforeValidateCallback:function(form,data,hasError){return window.qr.utils.code.factory.getModel().hasAjaxValidation(!1),window.qr.generator.forms.codeTypeDynamic.beforeValidateCallback(form,data,hasError)},afterValidateAttributeCallback:function(form,attribute,data,hasError){return window.qr.generator.forms.codeTypeDynamic.afterValidateAttributeCallback(form,attribute,data,hasError)},afterValidateCallback:function(form,data,hasError){return 0==allowDesignerStaticCodes?($(".disable-on-static").addClass("inactive"),$(".disable-on-static #resetTemplate").click(),$(".accordion-group").removeClass("active"),$(".accordion-body").removeClass("in")):($(".disable-on-static").removeClass("inactive"),$(".show-on-static.badge").remove(),$(".show-on-static.alert").remove()),window.qr.generator.forms.codeTypeDynamic.afterValidateCallback(form,data,hasError)}},extend(window,"qr.generator.forms"),window.qr.generator.forms.codeTypeMultiUrl={model:"AppUrlCriteriaForm",inputs:["activated","countries_id","operating_systems_id","start_datetime","end_datetime"],currentDateFormat:"",exportDateFormat:"YYYY-MM-DD HH:mm:ss",currentDate:"",modalInitialized:!1,init:function(dateFormat){var _this=this;this.currentDateFormat=dateFormat,this.currentDate=moment().format(this.currentDateFormat),$(document).off("click",".btnEditCriteria").on("click",".btnEditCriteria",function(e){e.stopPropagation(),e.preventDefault(),_this.editCriteria($(this).attr("index"))}),$(document).off("click",".btnRemoveCriteria").on("click",".btnRemoveCriteria",function(e){e.stopPropagation(),e.preventDefault();var __this=this;confirm(window.qr.texts.generator.forms.removeUrlConfirm1+$(__this).attr("index")+window.qr.texts.generator.forms.removeUrlConfirm2,window.qr.texts.generator.forms.removeCriteria,function(r){r&&_this.removeCriteria($(__this).attr("index"))})}),$(document).off("click",".btnAddCriteria").on("click",".btnAddCriteria",function(e){e.stopPropagation(),e.preventDefault(),_this.addCriteria()})},addCriteria:function(){var newIndex;window.addingCriteria||(newIndex=parseInt($(".criteria-rows>div:last-child").attr("index"))+1,window.addingCriteria=!0,window.qr.utils.events.trigger("generatorFormChanged"),$.get("/create/getcriteriainput",{id:newIndex},function(response){var $element=$(response),settings=($element.hide(),$(".criteria-rows>div:last-child").after($element),$element.find(".actions").removeClass("hidden"),$(".criteria-rows>div:last-child").fadeIn(200),window.addingCriteria=!1,setTimeout(function(){$(document).trigger("refreshTooltips")},200),$("#UrlCodeTrckable").data("settings"));$("[name^='AppUrlCriteria']",response).each(function(k,v){v=$.extend({id:$(v).attr("id"),inputID:$(v).attr("id"),errorID:$(v).attr("id")+"_em_",name:$(v).attr("name")},{model:"AppUrlCriteria",enableAjaxValidation:!0,errorCssClass:"errorMessage",status:1,hideErrorMessage:!1});settings.attributes.push(v)}),$("#UrlCodeTrckable").data("settings",settings)}))},removeCriteria:function(index){$(".criteria-rows>div:eq("+index+")").fadeOut(200,function(){$(this).remove()}),window.qr.utils.events.trigger("generatorFormChanged")},editCriteria:function(index){var _this=this,$tr=($("#criteriaFormModal").modal("show"),$($(".criteria-rows>div").get(index))),index=(this.modalInitialized||this.initDateTimePickers(),this.modalInitialized=!0,$("#enableStartDate").off("click").on("click",function(e){_startDateEnabled()?_enableStartDate(!0):_disableStartDate()}),$("#enableEndDate").off("click").on("click",function(e){_endDateEnabled()?_enableEndDate(!0):_disableEndDate()}),$("#btnSaveCriteria").off("click").on("click",function(){$tr.find(".countries_id").val($("#criteriaCountry").attr("countriesid")),$tr.find(".operating_systems_id").val($("#criteriaOS").attr("operatingsystemsid"));var startDate=0,endDate=0;$tr.find(".start_datetime").val(""),$tr.find(".end_datetime").val(""),_startDateEnabled()&&(startDate=$("#criteriaStartDate").val(),$tr.find(".start_datetime").val(moment(startDate,_this.currentDateFormat).format(_this.exportDateFormat))),_endDateEnabled()&&(endDate=$("#criteriaEndDate").val(),$tr.find(".end_datetime").val(moment(endDate,_this.currentDateFormat).format(_this.exportDateFormat))),startDate=$("#criteriaCountry").text()+"; "+$("#criteriaOS").text()+("0"!=startDate?" <br> <b>"+window.qr.texts.generator.forms.startDate+":</b> "+startDate:"")+("0"!=endDate?" <br><b>"+window.qr.texts.generator.forms.endDate+":</b> "+endDate:""),$tr.find(".metainformation_criteria").html(startDate),$("#criteriaFormModal").modal("hide"),$tr.find(".url").blur(),window.qr.utils.events.trigger("generatorFormChanged")}),document.querySelector("#countryDrop-controller")),countriesControllerScope=angular.element(index).scope(),index=(countriesControllerScope.$apply(function(){countriesControllerScope.selectedValue.criteriaCountry=$tr.find(".countries_id").val(),countriesControllerScope.dropModel.criteriaCountry=null}),document.querySelector("#criteriaOSDrop-controller")),criteriaOSControllerScope=angular.element(index).scope();function _enableStartDate(noDateSet){var datetimepicker=$("#criteriaStartDateContainer").data("DateTimePicker");datetimepicker.enable(),$(".row-scheduling-startdate input[type=text]").removeClass("disabled").removeAttr("disabled"),$("#enableStartDate").prop("checked",!0),noDateSet?datetimepicker.setDate(_this.currentDate):datetimepicker.setDate(moment($tr.find(".start_datetime",_this.exportDateFormat).val()).format(_this.currentDateFormat))}function _enableEndDate(noDateSet){var datetimepicker=$("#criteriaEndDateContainer").data("DateTimePicker");datetimepicker.enable(),$(".row-scheduling-enddate input[type=text]").removeClass("disabled").removeAttr("disabled"),$("#enableEndDate").prop("checked",!0),noDateSet?datetimepicker.setDate(_this.currentDate):datetimepicker.setDate(moment($tr.find(".end_datetime",_this.exportDateFormat).val()).format(_this.currentDateFormat))}function _disableStartDate(){$("#criteriaStartDateContainer").data("DateTimePicker").disable(),$("#enableStartDate").prop("checked",!1),$(".row-scheduling-startdate input[type=text]").addClass("disabled").attr("disabled","true")}function _disableEndDate(){$("#criteriaEndDateContainer").data("DateTimePicker").disable(),$("#enableEndDate").prop("checked",!1),$(".row-scheduling-enddate input[type=text]").addClass("disabled").attr("disabled","true")}function _startDateEnabled(){return $("#enableStartDate").prop("checked")}function _endDateEnabled(){return $("#enableEndDate").prop("checked")}criteriaOSControllerScope.$apply(function(){criteriaOSControllerScope.selectedValue.criteriaOS=$tr.find(".operating_systems_id").val(),criteriaOSControllerScope.dropModel.criteriaOS=null}),("0"!=$tr.find(".start_datetime").val()&&""!=$tr.find(".start_datetime").val()?_enableStartDate:_disableStartDate)(),("0"!=$tr.find(".end_datetime").val()&&""!=$tr.find(".end_datetime").val()?_enableEndDate:_disableEndDate)()},initDateTimePickers:function(){var options={minuteStepping:10,pickDate:!0,pickTime:!0,defaultDate:this.currentDate,dateFormat:this.currentDateFormat,sideBySide:!0,icons:{time:"icon icon-clock",date:"icon icon-calendar",up:"icon icon-chevron-up",down:"icon icon-chevron-down"}};window.innerWidth<1024&&(options.sideBySide=!1,window.innerWidth<768&&(options.pickerPosition="right")),$("#criteriaStartDateContainer").datetimepicker(options),$("#criteriaEndDateContainer").datetimepicker(options),$(document).on("click","#criteriaEndDateContainer .datepickerbutton",function(){$("#criteriaEndDate").is(":disabled")||$("#criteriaEndDateContainer").data("DateTimePicker").show()}),$(document).on("click","#criteriaStartDateContainer .datepickerbutton",function(){$("#criteriaStartDate").is(":disabled")||$("#criteriaStartDateContainer").data("DateTimePicker").show()})}},extend(window.qr,"generator.preview"),!1);window.qr.generator.preview={init:function(){var _this=this;$(".section-generator").on("change","select",function(){window.qr.utils.events.trigger("stateChanged")}),window.qr.utils.events.register("updateQRCode",_this.updateQRCode),window.qr.utils.events.register("colorChange",function(){window.qr.utils.events.trigger("stateChanged")}),$(".btn-slide-toggler").on("mousedown",function(){$(this).hasClass("active")?(window.qr.utils.states.set("saveAsDraft",!0),window.qr.utils.states.set("dontRedirectAfterSubmitting",!0),window.qr.utils.events.trigger("submitCode"),window.qr.utils.states.set("saveAsDraft",!1),$(".download-new-design").removeClass("show-button-left"),_this.showQRCode(),$(".newgenerator").is(".editMode")?(window.qr.generator.preview.stopQRCodeAnimation(),$(".qr-preview-overlay").hide()):$(".angularWrapper .ng-invalid").length<=0&&$(".angularWrapper .box-input.error").length<=0&&$(".angularWrapper .input-group.error").length<=0&&$("[name=yt0]").click()):(window.qr.utils.states.set("saveAsDraft",!1),$(".download-new-design").addClass("show-button-left"),_this.showSmartphone())}),$("#barcodeImage").load(function(){var incrementRefreshQRCode=window.qr.utils.states.get("incrementRefreshQRCode");1<=(incrementRefreshQRCode=void 0===incrementRefreshQRCode?0:incrementRefreshQRCode)&&$(".addToTemplates").slideDown(),incrementRefreshQRCode++,window.qr.utils.states.set("incrementRefreshQRCode",incrementRefreshQRCode),window.qr.generator.preview.stopQRCodeAnimation(),window.qr.generator.afterInit()}).error(function(){window.qr.generator.afterInit()}),this.initFixedPreviewContainer()},initFixedPreviewContainer:function(){var $previewContainerPhone=$(".preview-smartphone"),$previewContainerCode=$(".preview-qrcode");$(window).bind("scroll resize",function(e){var isPositionFixed="fixed"==$previewContainerPhone.css("position"),scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,offset=24;($(".state-generator-designer.row").hasClass("editMode")||$(".state-generator-data.row").hasClass("editMode"))&&(offset=60),(170<scrollTop&&!isPositionFixed||70<scrollTop&&isPositionFixed)&&$previewContainerPhone.css({position:"fixed",top:"24px"}),scrollTop<170&&isPositionFixed&&$previewContainerPhone.css({position:"absolute",top:offset+"px"})}),$(window).scroll(function(e){var isPositionFixed="fixed"==$previewContainerCode.css("position"),scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,offset=0;($(".state-generator-designer.row").hasClass("editMode")||$(".state-generator-data.row").hasClass("editMode"))&&(offset=60),(170<scrollTop&&!isPositionFixed||70<scrollTop&&isPositionFixed)&&$previewContainerCode.css({position:"fixed",top:"24px"}),scrollTop<170&&isPositionFixed&&$previewContainerCode.css({position:"absolute",top:offset+"px"})})},updateQRCode:function(){if(window.qr.utils.loader.hide("#formHere"),!$("#barcodeImage").is(":visible"))return!1;window.qr.generator.preview.startQRCodeAnimation(),(debounceQRCode=debounceQRCode||_.debounce(function(){var imageUrl=GLOBAL_API_ENDPOINT+"/v1/create?access-token="+GLOBAL_API_TOKEN;imageUrl+="&frame_name=no-frame&image_format=PNG&image_width=500",0<$("#oldCodeId").val()?(imageUrl=(imageUrl+="&qr_code_id="+$("#oldCodeId").val())+"&rnd="+(new Date).getTime(),$("#barcodeImage").attr("src",imageUrl)):$("#formHere").attr("data-code-content")?(imageUrl=(imageUrl+="&qr_code_text="+encodeURIComponent($("#formHere").attr("data-code-content")))+"&rnd="+(new Date).getTime(),$("#barcodeImage").attr("src",imageUrl)):$("#barcodeImage").attr("src","/img/qrcode_placeholder.png")},500))()},spinner:!1,startQRCodeAnimation:function(){$(".qr-preview-overlay").css("opacity","1"),this.qrSpinner?this.qrSpinner.spin($(".qr-preview-overlay:visible")[0]):this.qrSpinner=new Spinner(window.qr.CONSTANTS.SPINNER_OPTIONS).spin($(".qr-preview-overlay:visible")[0]),$(".qr-preview-overlay").addClass("loading2")},stopQRCodeAnimation:function(){($(".angularWrapper .ng-invalid").length||$(".angularWrapper .box-input.error").length)&&$(".mockup__qrcode").addClass("barCodeError"),this.qrSpinner&&this.qrSpinner.stop(),$(".qr-preview-overlay").removeClass("loading2"),$(".qr-preview-overlay").css("opacity","0")},showQRCode:function(){$(".btn-slide-toggler").removeClass("active"),$(".mockup__preview ").addClass("showQRCode"),$(".preview-smartphone").hide(),$(".preview-qrcode").show(),window.qr.utils.events.trigger("updateQRCode")},showSmartphone:function(){$(".btn-slide-toggler").addClass("active"),$(".mockup__preview ").removeClass("showQRCode"),$(".preview-smartphone").show(),$(".preview-qrcode").hide()}},extend(window.qr,"generator.livepreview"),window.qr.generator.livepreview=function(){function previewLandscape(){var windowHeight=$(window).height(),windowWidth=$(window).width(),smartphoneHeight=0,smartphoneHeight=399<windowWidth?516:358;windowWidth<768&&windowHeight-100<smartphoneHeight?($(".qrcode_create").addClass("hiddenAbsolute"),$(".mockup__smartphone").addClass("hiddenAbsolute"),$("#wrapper").addClass("orientationMessage"),$(".landscapeOrientation").show()):($(".qrcode_create").removeClass("hiddenAbsolute"),$(".mockup__smartphone").removeClass("hiddenAbsolute"),$("#wrapper").removeClass("orientationMessage"),$(".landscapeOrientation").hide())}previewLandscape(),$(".footer__view-mobile ul li").on("click",function(){previewLandscape()}),$(window).resize(function(){previewLandscape()});var hoganTemplate=!1,currentCodeType="",$placeholder=!1;function _getData(type){return function(type){type+="GetData";if("function"==typeof window[type])return window[type]();var data={};return $.each($("[template-populate=true]"),function(index,obj){var value=$(obj).val(),obj=$(obj).attr("template-variable");data[obj]=value}),data}(type)}var _compile=_.throttle(function(type,data){var hasCodeThisFunction;hoganTemplate&&(hasCodeThisFunction=type+"BeforeRender",(data="function"==typeof window[hasCodeThisFunction]?window[hasCodeThisFunction](data):data).DESKTOP=!0,$placeholder.html(hoganTemplate.render(data)),hasCodeThisFunction=type+"AfterRender","function"==typeof window[hasCodeThisFunction]&&window[hasCodeThisFunction](data))},0);return{init:function(){var _this=this,_tempCodetype=!1;videoObj={devent:0,dsocial:0,dbusiness:0,dvideo:0,angular:0,drating:0},$placeholder=$("#smartphonePlaceholder"),window.qr.utils.events.register("generatorFormChanged",function(){_this.update()}),window.qr.utils.events.register("changeCodeType",function(event,codetype){_tempCodetype=codetype}),window.qr.utils.events.register("afterFormLoad",function(event,codetype){_tempCodetype=codetype,_this.setTemplate(_tempCodetype)}),window.qr.utils.events.register("setPlaceholderImage",function(event,codetype){_this.setPlaceholderImage(codetype)}),window.qr.utils.events.register("setPlaceholderVideo",function(event,codetype){_this.setPlaceholderVideo(codetype)}),window.qr.utils.events.register("generatorSlideFinished",function(event,index){switch(index){case 1:_this.setTemplate(_tempCodetype);break;case 2:window.qr.utils.events.trigger("updateQRCode")}})},setPlaceholderImage:function(type){var iconName;0==window.qr.generator.getCurrentIndex()&&window.qr.utils.states.get("generatorState","codeTypeChooser")&&("undefined"!=typeof videoPreviewHTML&&($(".loading-video").hide(),clearTimeout(videoPreviewHTML)),$("#imgPlaceholder").html(""),$(".preview-smartphone-wrapper").addClass("noVideo"),$("#imgPlaceholder").removeClass("previewVideo").addClass("previewNoVideo"),$("#imgPlaceholder").css("overflow","hidden"),type?($(".creation-no-default").hide(),$(".redesign .preview").addClass("active"),$(".preview-smartphone-wrapper").show(),$("#imgPlaceholder").html("<img src='/img/generator/preview-type-"+type+"-"+window.qr.utils.getLang()+".jpg' style='max-width:320px;width:320px;'>")):($(".static-code-text").hide(),$(".code-white-card").hide(),$(".preview-smartphone-wrapper").hide(),$(".redesign .preview").removeClass("active"),$(".creation-no-default").show()),0<$('[data-type="'+type+'"]').parents(".dynamiccodes").length&&("instagram"===type?($(".static-code-text").show(),$(".code-white-card").hide()):($(".static-code-text").hide(),$(".code-white-card").show(),$("#code-image").attr("src","//s3.eu-central-1.amazonaws.com/qrcgappcdn/preview-code/preview-"+type+"-code.jpg"),iconName=$('[data-type="'+type+'"]').find("i").attr("class"),$("#code-icon").attr("class",iconName))),0<$('[data-type="'+type+'"]').parents(".staticcodes").length&&($(".static-code-text").show(),$(".code-white-card").hide()))},setPlaceholderVideo:function(type){function placeVideoInHolder(type){$("#imgPlaceholder").html("</div><button id='playPauseVideo' class=''><i class='icon-generator-pause'></i></button><video id='previewVideo' width='320' height='516' loop onclick='this.paused ? this.play() : this.pause();'><source src='https://s3.eu-central-1.amazonaws.com/qrcgappcdn/assets/videos/preview-type-"+type+".mp4' type='video/mp4'></video><script>$(document).ready(function () {$('#playPauseVideo').click(function () {if ($('#playPauseVideo').hasClass('active')) {document.getElementById('previewVideo').play();$('#playPauseVideo i').removeClass('icon-generator-play').addClass('icon-generator-pause');$('#playPauseVideo').toggleClass('active');} else {document.getElementById('previewVideo').pause();$('#playPauseVideo i').removeClass('icon-generator-pause').addClass('icon-generator-play');$('#playPauseVideo').toggleClass('active');}});setTimeout(function() {var e=document.getElementById('previewVideo');if(e){e.style.opacity=0;var vid=document.getElementById('previewVideo');vid.oncanplaythrough=function(){showVideoAfterLoad();};}},0);});<\/script>")}768<=window.innerWidth&&0==window.qr.generator.getCurrentIndex()&&window.qr.utils.states.get("generatorState","codeTypeChooser")&&("undefined"!=typeof videoPreviewHTML&&($(".loading-video").hide(),clearTimeout(videoPreviewHTML)),$("#imgPlaceholder").html(""),videoObj[type]++,$(".preview-smartphone-wrapper").removeClass("noVideo"),$("#imgPlaceholder").removeClass("previewNoVideo").addClass("previewVideo"),$("#imgPlaceholder").css("overflow","hidden"),$("#imgPlaceholder").html(""),1<videoObj[type]?($(".preview-smartphone-wrapper .loading-video").show(),placeVideoInHolder(type)):($(".preview-smartphone-wrapper .loading-video").show(),videoPreviewHTML=setTimeout(function(){placeVideoInHolder(type)},2e3)))},update:function(){if(1==$("#disableHogan").length)return!1;currentCodeType&&_compile(currentCodeType,_getData(currentCodeType))},setTemplate:function(type){var _this=this;"url"==type||"url_static"==type||"email"==type||"sms"==type||"text"==type?$(".mockup__preview").addClass("url_noAffix"):$(".mockup__preview").removeClass("url_noAffix"),_.isUndefined($("[template-populate=true]").length)||0==$("[template-populate=true]").length?(window.qr.utils.events.trigger("setPlaceholderImage",type),currentCodeType=!1):currentCodeType!=type&&(currentCodeType=type,$.ajax({url:(qrcodeTypeId=parseInt($("[id$='qrcode_type_id']").val()),templateID=parseInt($("[id$='app_templates_id']").val()),"/preview/loadTemplate/qrcode_type_id/"+qrcodeTypeId+"/template_id/"+templateID),success:function(templateString){if(1==$("#disableHogan").length)return $("#smartphonePlaceholder").html(templateString),!1;hoganTemplate=Hogan.compile(templateString),_this.update()},error:function(){window.location.assign("/site/logout/?relogin=1")}}))}}},extend(window.qr,"scanner"),window.qr.scanner={stop:function(){return $("body").attr("oncontextmenu",""),$("#scanner_div.current").remove(),!1},dontshowagain:function(){},init:function(){this.stop(),$("body").attr("oncontextmenu","window.qr.scanner.stop();return false;");var scannerDiv=$("#scanner_div").clone().addClass("current").removeClass("hidden"),_that=($("body").append(scannerDiv),$(".view",scannerDiv).addClass("hidden"),$(".view.wait",scannerDiv).removeClass("hidden"),offsetButton=$("#scannerButton").offset(),$(scannerDiv).css({left:+offsetButton.left,top:offsetButton.top-70}),_.delay(function(){$("#scanner_div.current").stop().effect("transfer",{to:$(".qr-preview-overlay").eq(0)},2e3)},300),$("body").mousedown(function(event){if(3===event.which)return!1}),$(document).on("mousemove",function(e){$(scannerDiv).css({left:e.pageX-100,top:e.pageY-100}),$(scannerDiv).css("z-index","0"),element=document.elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset),$(element).hasClass("qr-preview-overlay")?$(".view.wait",scannerDiv).addClass("hover").css("border","2px solid #90c52d"):$(".view.wait",scannerDiv).removeClass("hover").css({"border-top":"1px solid #D4D4D4","border-bottom":"1px solid #D4D4D4","border-left":"1px solid #fff","border-right":"1px solid #fff"}),$(scannerDiv).css("z-index","999")}),this);$(scannerDiv).unbind("click").click(function(e){var isDynamic,shortDomain,src;$(scannerDiv).css("z-index","0"),element=document.elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset),$(scannerDiv).css("z-index","999"),$(element).hasClass("qr-preview-overlay")?($(".view",scannerDiv).addClass("hidden"),$(".view.decode_wait",scannerDiv).removeClass("hidden"),$("#scanner_div.current .bottom_text").addClass("hidden"),$("#scanner_div.current").addClass("small-scan-box"),isDynamic=$(element).parents(".codeInfo").attr("dynamic"),e=$(element).parents(".imgContainer ").attr("item-id"),shortDomain=$("a.shortdomain",$(element).parents(".codeInfo")).attr("href"),src=$("img",$(element).parent()).attr("scanner-src"),$("img",$(element).parent()).attr("temp-recreate"),src&&0<src.length&&($(".view",scannerDiv).addClass("hidden"),$(".view.decode_wait",scannerDiv).removeClass("hidden"),$.get("/manage/isscanable",{url:src,codeId:e},function(result){var cleanURL,$img;_that.dontshowagain(),"true"==result.success?(isDynamic&&(cleanURL=result.url,shortDomain!=cleanURL&&(cleanURL=$(".qr-preview-overlay",$(element).parent()).css("opacity",1),($img=$(".qrcode_preview_image",$(element).parent())).attr("src",$img.attr("temp-recreate")),cleanURL.stop().delay(2e3).fadeTo(500,0),result.url=shortDomain)),$(scannerDiv).css("background","transparent"),$(scannerDiv).css("border-color","green"),$(scannerDiv).stop().delay(2e3).fadeTo(500,0),$(".view",scannerDiv).addClass("hidden"),$(".view.decode_success",scannerDiv).removeClass("hidden"),$("#scanner_div.current .bottom_text").removeClass("hidden"),$("#scanner_div.current").removeClass("small-scan-box"),result.loadIframe&&$("body").append("<iframe src='"+result.loadIframe+"' class='hidden' onLoad=''>")):($(scannerDiv).css("background","transparent"),$(scannerDiv).stop().delay(2e3).fadeTo(500,0),$(".view",scannerDiv).addClass("hidden"),$(".view.decode_failed",scannerDiv).removeClass("hidden"))},"json"),$(document).unbind("mousemove"))):($("#scanner_div.current").stop().effect("transfer",{to:$(".qr-preview-overlay").eq(0)},1500),$(".view",scannerDiv).addClass("hidden"),$(".view.click_no_code",scannerDiv).removeClass("hidden"),$("#scanner_div.current .bottom_text").addClass("hidden"),$("#scanner_div.current").addClass("small-scan-box"),window.setTimeout(function(){$(".view",scannerDiv).addClass("hidden"),$(".view.wait",scannerDiv).removeClass("hidden"),$("#scanner_div.current .bottom_text").removeClass("hidden"),$("#scanner_div.current").removeClass("small-scan-box")},500))})},scan:function(){}},extend(window.qr,"utils.snowplow"),window.qr.utils.snowplow={_SnowplowSettings:function(){var snowplowSettings={};return{user_id:(snowplowSettings=window.snowplowSettings?window.snowplowSettings:snowplowSettings).user_id||null,industry_id:snowplowSettings.industry_id?+snowplowSettings.industry_id:null,language:snowplowSettings.language||"en"}},_SnowplowTrackStructEvent:function(data){"true"===window.GLOBAL_VUE_APP_SNOWPLOW_ENABLED&&window.snowplow&&window.snowplow("trackStructEvent",data)},_SnowplowEventContext:function(data){return{schema:"iglu:com.egoditor/event/jsonschema/1-0-0",data:{product:data.product,call_to_action:data.call_to_action,event_intent:data.event_intent}}},_SnowplowFrontendContext:function(data){return{schema:"iglu:com.egoditor/frontend/jsonschema/1-0-0",data:{page_name:data.page_name,element_type:data.element_type,element_name:data.element_name,interaction_type:data.interaction_type,language_code:this._SnowplowSettings().language}}},_SnowplowUserContext:function(){return{schema:"iglu:com.egoditor/user/jsonschema/1-0-0",data:{industry_id:this._SnowplowSettings().industry_id,tracking_consent_status:!0,user_id:this._SnowplowSettings().user_id}}},trackCreateQrCodeNextButtonClicked:function(data){var eventToBeSent={action:"create_qr_code.next_button.clicked",category:"qr_codes.creation",context:[this._SnowplowEventContext({product:"qrcg",call_to_action:"create_qr_code",event_intent:"clicked"}),this._SnowplowFrontendContext({page_name:"create_qr_code_last_step",element_type:"button",element_name:"next_button",interaction_type:"click"}),this._SnowplowUserContext()]};this._SnowplowTrackStructEvent(eventToBeSent)},trackUpsellingBannerUpgradeButtonClicked:function(){var eventToBeSent={action:"upgrade_plan.upgrade_to_advanced_button.clicked",category:"qr_codes.qrcg",context:[this._SnowplowEventContext({product:"qrcg",call_to_action:"UPGRADE TO ADVANCED",event_intent:"clicked"}),this._SnowplowFrontendContext({page_name:"manage_view",element_type:"button",interaction_type:"click"}),this._SnowplowUserContext()]};this._SnowplowTrackStructEvent(eventToBeSent)},_SnowplowPageView:function(){"true"===window.GLOBAL_VUE_APP_SNOWPLOW_ENABLED&&window.snowplow&&window.snowplow("trackPageView",{context:[this._SnowplowFrontendContext({page_name:window.location.pathname,interaction_type:"navigation"}),this._SnowplowUserContext()]})}},extend(window.qr,"utils.webcomponents"),window.qr.utils.webcomponents={init:function(data){if(data.element&&data.renderElement){var scriptEle=document.createElement(data.element);if(data.attributes&&data.attributes.length)for(var i=0;i<data.attributes.length;i++){var attr=data.attributes[i];scriptEle.setAttribute(attr.key,attr.value)}var element=document.querySelector(data.renderElement);element.textContent="",element.appendChild(scriptEle)}}};